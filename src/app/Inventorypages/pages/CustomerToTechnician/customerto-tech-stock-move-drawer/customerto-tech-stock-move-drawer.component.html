<div *ngIf="drawerfor == 'ADDORUPDATE'">
  <form
    nz-form
    #stockmaster="ngForm"
    [ngClass]="{ 'responsive-form-margin': screenwidth <= 500 }"
  >
    <nz-spin [nzSpinning]="isSpinning">
      <div nz-row class="form-container">
        <div class="my-box">
          <div nz-row>
            <div nz-col nzXs="4" nzSm="4" nzMd="4" nzLg="4" nzXl="4">
              <nz-form-item>
                <nz-form-label nzRequired nzNoColon>Date</nz-form-label>
                <nz-form-control nzHasFeedback nzErrorTip="Please Select Date">
                  <nz-date-picker
                    name="date"
                    class="date-picker-width"
                    [nzFormat]="commonFunction.dateFormatMMM"
                    [(ngModel)]="data.DATE"
                    [nzShowToday]="false"
                    required
                    disabled
                  >
                  </nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="10" *ngIf="data.TRANSFER_MODE == 'W'">
              <nz-form-item>
                <nz-form-label nzRequired nzNoColon>Customer</nz-form-label>
                <nz-form-control nzHasFeedback nzErrorTip="Select Customer">
                  <nz-select
                    nzPlaceHolder="Select Customer"
                    name="fromgodown"
                    nzAllowClear="false"
                    [nzLoading]="isFromGodownLoading"
                    [(ngModel)]="data.CUSTOMER_ID"
                    (ngModelChange)="
                      changeFromGodown($event);
                      getTechnician($event);
                      getcustname($event)
                    "
                    nzShowSearch
                    required
                  >
                    <nz-option
                      *ngFor="let report of LoadGodown"
                      [nzValue]="report.ID"
                      [nzLabel]="report.NAME"
                    >
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div nz-col nzSpan="10" *ngIf="data.TRANSFER_MODE == 'W'">
              <nz-form-item>
                <nz-form-label nzRequired nzNoColon>Technician</nz-form-label>
                <nz-form-control nzHasFeedback nzErrorTip="Select Technician">
                  <nz-select
                    name="Destinationgodown"
                    nzPlaceHolder="Select Technician"
                    [nzLoading]="isFromGodownLoading1"
                    [(ngModel)]="data.TECHNICIAN_ID"
                    (ngModelChange)="changeFromGodown(data.CUSTOMER_ID)"
                    nzAllowClear="false"
                    nzShowSearch
                    required
                  >
                    <nz-option
                      *ngFor="let destinationGodown of technicianData"
                      [nzValue]="destinationGodown.ID"
                      [nzLabel]="destinationGodown.NAME"
                    >
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>
        <form nz-form #form2="ngForm">
          <div class="my-box">
            <div nz-row>
              <div nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Part Name</nz-form-label>
                  <nz-form-control
                    nzHasFeedback
                    nzErrorTip="Please Select Part Name"
                  >
                    <nz-select
                      nzShowSearch
                      nzAllowClear="false"
                      nzPlaceHolder="Select Part Name"
                      name="INVENTORY_ID"
                      [(ngModel)]="INVENTORY_ID"
                      required
                      (ngModelChange)="getNamesCatAndSub($event)"
                    >
                      <nz-option
                        nzCustomContent
                        *ngFor="let data of Itemdata"
                        [nzValue]="data.ID"
                        [nzLabel]="
                          data?.VARIANT_COMBINATION
                            ? data?.VARIANT_COMBINATION
                            : data.ITEM_NAME
                        "
                      >
                        <div nz-row class="option-container">
                          <div nz-col nzSpan="24" class="option-category">
                            {{ data.INVENTORY_CATEGORY_NAME }} >
                            {{ data.INVENTRY_SUB_CATEGORY_NAME }}
                          </div>
                          <div nz-col nzSpan="24" class="option-name">
                            {{
                              data?.VARIANT_COMBINATION
                                ? data?.VARIANT_COMBINATION
                                : data.ITEM_NAME
                            }}
                          </div>
                        </div>
                      </nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="3" class="add-button-col">
                <nz-form-item class="add-button-form-item">
                  <nz-form-label nzNoColon></nz-form-label>
                  <nz-form-control>
                    <button
                      nz-button
                      nzType="primary"
                      (click)="addData(true, form2)"
                      class="add-update-button"
                    >
                      <i nz-icon nzType="plus"></i>
                      <span *ngIf="index == -1">Add</span>
                      <span *ngIf="index != -1">Update</span>
                    </button>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="24">
                <div nz-row class="inventory-info-row">
                  <div
                    nz-col
                    nzSpan="8"
                    *ngIf="
                      data2 != undefined &&
                      data2.QUANTITY != undefined &&
                      data2.QUANTITY != null &&
                      data2.QUANTITY > 0
                    "
                  >
                    <nz-form-item>
                      <span class="inventory-info-label">
                        Quantity :
                        <span class="inventory-info-value"
                          >{{ data2.QUANTITY }} &nbsp;{{
                            data2.UNIT_NAME
                          }}</span
                        >
                      </span>
                    </nz-form-item>
                  </div>
                  <div
                    nz-col
                    nzSpan="8"
                    *ngIf="
                      data2.INVENTORY_TRACKING_TYPE != undefined &&
                      data2.INVENTORY_TRACKING_TYPE == 'S'
                    "
                  >
                    <nz-form-item>
                      <span class="inventory-info-label">
                        Serial No. :
                        <span class="inventory-info-value">{{
                          data2.SERIAL_NO
                        }}</span>
                      </span>
                    </nz-form-item>
                  </div>
                  <div
                    nz-col
                    nzSpan="8"
                    *ngIf="
                      data2.INVENTORY_TRACKING_TYPE != undefined &&
                      data2.INVENTORY_TRACKING_TYPE == 'B'
                    "
                  >
                    <nz-form-item>
                      <span class="inventory-info-label">
                        Batch No. :
                        <span class="inventory-info-value">{{
                          data2.BATCH_NO
                        }}</span>
                      </span>
                    </nz-form-item>
                  </div>
                </div>
                <hr class="inventory-divider" />
              </div>
            </div>
            <div nz-row class="table-container">
              <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
                <nz-table
                  class="my-scroll no-wrap1 inventory-table"
                  nzBordered
                  #maptrainpoint
                  nzShowSizeChanger
                  [nzData]="items"
                  [nzBordered]="true"
                  [nzFrontPagination]="false"
                  [nzTotal]="totaldata"
                  [(nzPageIndex)]="pageIndex"
                  [(nzPageSize)]="pageSize"
                  [nzShowPagination]="false"
                  [nzScroll]="{ y: '290px' }"
                  nzSize="small"
                >
                  <thead>
                    <tr>
                      <th class="action-column">Action</th>
                      <th class="part-name-column">Part Name</th>
                      <th class="serial-no-column">Serial No.</th>
                      <th class="batch-no-column">Batch No.</th>
                      <th class="quantity-column">Quantity</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let data of maptrainpoint.data; let i = index"
                      class="inventory-row"
                    >
                      <td class="action-cell">
                        <nz-space>
                          <a
                            *nzSpaceItem
                            (click)="edit(data, i)"
                            nz-tooltip
                            nzTooltipTitle="Edit"
                            class="edit-action"
                          >
                            <span
                              nz-icon
                              nzType="edit"
                              nzTheme="twotone"
                            ></span>
                          </a>
                          <a
                            *nzSpaceItem
                            nz-tooltip
                            nzTooltipTitle="Delete"
                            class="delete-action"
                          >
                            <span
                              *ngIf="index == -1"
                              class="delete-icon-wrapper"
                              nz-popconfirm
                              nzPopconfirmTitle="Are you sure, you want to delete?"
                              nzPopconfirmPlacement="top"
                              (nzOnConfirm)="delete(data, i)"
                              (nzOnCancel)="cancel()"
                            >
                              <span
                                nz-icon
                                nzType="delete"
                                nzTheme="outline"
                                class="delete-icon"
                                nz-tooltip
                                nzTooltipTitle="Delete"
                              >
                              </span>
                            </span>
                          </a>
                        </nz-space>
                      </td>
                      <td
                        nz-tooltip
                        [nzTooltipTitle]="data['INVENTORY_NAME']"
                        class="part-name-cell"
                      >
                        <span
                          [attr.title]="data['INVENTORY_NAME']"
                          class="part-name-text"
                        >
                          {{ data["INVENTORY_NAME"] }}
                          <span class="variant-name">{{
                            data?.VARIANT_NAME
                          }}</span>
                        </span>
                      </td>
                      <td class="serial-no-cell">
                        {{ data["SERIAL_NO"] }}
                      </td>
                      <td class="batch-no-cell">
                        {{ data["BATCH_NO"] }}
                      </td>
                      <td class="quantity-cell">
                        {{ data["QUANTITY"] }} {{ data["UNIT_NAME"] }}
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </div>
          </div>
        </form>
      </div>
    </nz-spin>
  </form>
  <div class="footer">
    <button
      type="button"
      nz-button
      (click)="close()"
      class="ant-btn cancel-button"
    >
      <span>Cancel</span>
    </button>
    <button
      type="button"
      class="ant-btn ant-btn-primary save-close-button"
      *ngIf="!data.ID"
      [nzLoading]="isSpinning"
      nz-button
      (click)="save(false, stockmaster)"
    >
      <span>Save & Close</span>
    </button>
    <nz-dropdown-menu #menu="nzDropdownMenu">
      <ul nz-menu>
        <li nz-menu-item class="dropdown-menu-item">
          <a class="dropdown-menu-link" (click)="save(true, stockmaster)">
            Save & New
          </a>
        </li>
      </ul>
    </nz-dropdown-menu>
    <button
      type="button"
      class="ant-btn ant-btn-primary update-close-button"
      nz-button
      [nzLoading]="isSpinning"
      *ngIf="data.ID"
      (click)="save(false, stockmaster)"
    >
      <span>Update & Close</span>
    </button>
  </div>
</div>
<div *ngIf="drawerfor == 'VIEW' || drawerfor == 'APPROVE'">
  <div nz-row class="view-header">
    <div nz-col nzSpan="8" class="view-date">
      <b>Date :</b> {{ data.DATE | date : "dd/MM/yyyy HH:mm a" }}
    </div>
    <div nz-col nzSpan="8" class="view-customer">
      <b>Customer Name : </b>
      <span
        nz-popover
        [nzPopoverTitle]="data.CUSTOMER_NAME"
        class="customer-name"
      >
        {{ data.CUSTOMER_NAME }}
      </span>
    </div>
    <div nz-col nzSpan="8" class="view-technician">
      <b>Technician Name : </b>
      <span
        nz-popover
        [nzPopoverTitle]="data.TECHNICIAN_NAME"
        class="technician-name"
      >
        {{ data.TECHNICIAN_NAME }}
      </span>
    </div>
  </div>
  <div nz-row class="view-table-container">
    <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
      <nz-table
        class="my-scroll no-wrap1 view-inventory-table"
        nzBordered
        #maptrainpoint
        nzShowSizeChanger
        [nzData]="items"
        [nzBordered]="true"
        [nzFrontPagination]="false"
        [nzTotal]="totaldata"
        [nzShowPagination]="false"
        [nzScroll]="{ y: '290px' }"
        nzSize="small"
      >
        <thead>
          <tr>
            <th class="view-item-name-column">Item Name</th>
            <th class="view-serial-no-column">Serial No.</th>
            <th class="view-batch-no-column">Batch No.</th>
            <th class="view-quantity-column">Quantity</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let data of maptrainpoint.data; let i = index"
            class="view-inventory-row"
          >
            <td class="view-item-name-cell">
              <span
                [attr.title]="data['INVENTORY_NAME']"
                class="item-name-text"
              >
                {{ data["INVENTORY_NAME"] }}
              </span>
            </td>
            <td class="view-serial-no-cell">
              {{ data["SERIAL_NO"] ? data["SERIAL_NO"] : "-" }}
            </td>
            <td class="view-batch-no-cell">
              {{ data["BATCH_NO"] ? data["BATCH_NO"] : "-" }}
            </td>
            <td class="view-quantity-cell">
              {{ data["QUANTITY"] }} &nbsp;{{ data["UNIT_NAME"] }}
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
  <div class="footer">
    <button
      type="button"
      nz-button
      (click)="close()"
      class="ant-btn view-cancel-button"
    >
      <span>Cancel</span>
    </button>
  </div>
</div>
<nz-modal
  [nzWidth]="500"
  [(nzVisible)]="showreject"
  nzMaskClosable="false"
  nzClosable="false"
  [nzContent]="content"
  [nzTitle]="'Profile Photo View'"
  [nzFooter]="ImageModalFooter"
>
  <ng-template #content>
    <nz-spin [nzSpinning]="isSpinning">
      <div nz-row>
        <div nz-col nzXs="24" nzSm="24" nzMd="24" nzLg="24" nzXl="24">
          <nz-form-item>
            <nz-form-label nzNoColon>Reject Remark</nz-form-label>
            <nz-form-control>
              <textarea
                nz-input
                rows="2"
                name="data.REASON"
                autocomplete="off"
                autofill="off"
                placeholder="Enter Reject Remark"
                [(ngModel)]="data.REASON"
                maxlength="500"
                class="reject-remark-textarea"
              >
              </textarea>
              <h6 class="character-counter" *ngIf="data.REASON != undefined">
                {{ data.REASON.length }}/ 500
              </h6>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </nz-spin>
  </ng-template>
  <ng-template #ImageModalFooter>
    <button
      nz-button
      nzType="default"
      [nzLoading]="isSpinning"
      (click)="closereject()"
      class="modal-close-button"
    >
      Close</button
    >&nbsp;
    <button
      nz-button
      nzType="primary"
      [nzLoading]="isSpinning"
      (click)="reject()"
      class="modal-reject-button"
    >
      Reject
    </button>
  </ng-template>
</nz-modal>
