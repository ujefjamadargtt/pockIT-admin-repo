<div>
  <div nz-row nzType="flex" class="header-row">
    <div nz-col nzXs="24" nzSm="24" nzMd="20" nzLg="20" nzXl="8">
      <div class="formname">
        <span
          (click)="back()"
          nz-icon
          nzType="arrow-left"
          nzTheme="outline"
          class="back-arrow-icon"
        ></span
        >&nbsp;&nbsp;{{ formTitle }}
      </div>
    </div>
    <div
      nz-col
      nzXs="24"
      nzSm="24"
      nzMd="4"
      nzLg="6"
      nzXl="16"
      class="header-controls"
    >
      <form nz-form [nzLayout]="'inline'">
        <nz-form-item class="filter-button-container">
          <button
            nz-button
            nzTooltipTitle="Filter"
            nzTooltipPlacement="top"
            nz-tooltip
            [nzType]="isfilterapply ? 'primary' : 'default'"
            class="filter-toggle-btn"
            (click)="showMainFilter()"
          >
            <i nz-icon nzType="filter"></i>
          </button>
        </nz-form-item>
        <nz-form-item class="search-container">
          <nz-input-group
            nzSearch
            [nzAddOnAfter]="suffixIconButton"
            class="search-input-group"
          >
            <input
              type="text"
              name="search"
              (keyup)="keyup($event)"
              (keydown.enter)="onEnterKey($event)"
              autocomplete="off"
              [(ngModel)]="searchText"
              nz-input
              placeholder="Min 3 chars required."
              class="search-input"
            />
          </nz-input-group>
          <ng-template #suffixIconButton>
            <button
              nz-button
              nzType="primary"
              (click)="search(true)"
              nzSearch
              class="search-btn"
            >
              <i nz-icon nzType="search"></i>
            </button>
          </ng-template>
        </nz-form-item>
      </form>
    </div>
  </div>
  <div nz-row>
    <div nz-col nzSpan="24">
      <div class="filter {{ filterClass }}">
        <div class="filter-box">
          <div nz-row class="filter-content-row">
            <div nz-col [nzSpan]="24">
              <ng-container *ngIf="filterloading; else filtersContent">
                <div class="filter-loading-container">
                  <nz-spin nzSimple></nz-spin>
                </div>
              </ng-container>
              <ng-template #filtersContent>
                <ng-container
                  *ngIf="savedFilters && savedFilters.length > 0; else noData"
                >
                  <div nz-row nzGutter="8" class="filter-grid">
                    <div
                      nz-col
                      nzSpan="6"
                      *ngFor="let item of savedFilters"
                      class="filter-card-col"
                    >
                      <nz-card class="filter-card">
                        <div class="filter-card-header">
                          <span class="filter-name">
                            <span *ngIf="item.FILTER_NAME != null">
                              <span
                                *ngIf="item.FILTER_NAME.length >= 25"
                                nz-popover
                                [nzPopoverContent]="item.FILTER_NAME"
                                nzPopoverPlacement="topLeft"
                                class="truncated-filter-name"
                              >
                                {{ item.FILTER_NAME | slice : 0 : 25
                                }}{{
                                  item.FILTER_NAME.length > 25 ? "..." : ""
                                }}
                              </span>
                              <span
                                *ngIf="item.FILTER_NAME.length < 25"
                                class="full-filter-name"
                              >
                                {{ item.FILTER_NAME }}
                              </span>
                            </span>
                            <span
                              *ngIf="item.FILTER_NAME == null"
                              class="empty-filter-name"
                              >-</span
                            >
                          </span>
                          <i
                            *ngIf="selectedFilter === item.ID"
                            nz-icon
                            [nzType]="'check-circle'"
                            [nzTheme]="'twotone'"
                            [nzTwotoneColor]="'#52c41a'"
                            nz-tooltip
                            [nzTooltipTitle]="
                              'This filter is applied on current data'
                            "
                            class="filter-applied-icon"
                          ></i>
                        </div>
                        <div nz-row class="filter-actions-row">
                          <div nz-col nzSpan="24" class="filter-actions">
                            <nz-tag
                              nzColor="#2db7f5"
                              (click)="editQuery(item)"
                              class="filter-action-tag edit-tag"
                              nz-tooltip
                              nzTooltipTitle="Edit Filter"
                            >
                              <span
                                nz-icon
                                nzType="edit"
                                nzTheme="outline"
                                class="tag-icon"
                              >
                              </span
                              >&nbsp;&nbsp;Edit</nz-tag
                            >
                            <nz-tag
                              *ngIf="selectedFilter !== item.ID"
                              nzColor="#87d068"
                              (click)="applyfilter(item)"
                              class="filter-action-tag apply-tag"
                              nz-tooltip
                              nzTooltipTitle="Apply Filter"
                            >
                              <span
                                nz-icon
                                nzType="search"
                                nzTheme="outline"
                                class="tag-icon"
                              >
                              </span
                              >&nbsp;&nbsp;Apply</nz-tag
                            >
                            <nz-tag
                              *ngIf="selectedFilter === item.ID"
                              nzColor="#faad14"
                              (click)="Clearfilter()"
                              class="filter-action-tag clear-tag"
                              nz-tooltip
                              nzTooltipTitle="Clear this Filter"
                            >
                              <span
                                nz-icon
                                nzType="close"
                                nzTheme="outline"
                                class="tag-icon"
                              >
                              </span
                              >&nbsp;&nbsp;Clear</nz-tag
                            >
                            <nz-tag
                              nzColor="#cd201f"
                              nz-popconfirm
                              nzPopconfirmTitle="Are you sure to delete this record?"
                              nzPopconfirmPlacement="top"
                              (nzOnConfirm)="deleteItem(item)"
                              class="filter-action-tag delete-tag"
                              nz-tooltip
                              nzTooltipTitle="Delete Filter"
                            >
                              <span
                                nz-icon
                                nzType="delete"
                                nzTheme="outline"
                                class="tag-icon"
                              >
                              </span
                              >&nbsp;&nbsp;Delete</nz-tag
                            >
                            <nz-tag
                              nzColor="#3b5999"
                              class="filter-action-tag view-tag"
                              nz-tooltip
                              nzTooltipTitle="View Filter Text"
                              (click)="toggleLiveDemo(item)"
                            >
                              <span
                                nz-icon
                                nzType="eye"
                                nzTheme="outline"
                                class="tag-icon"
                              >
                              </span
                              >&nbsp;&nbsp;View</nz-tag
                            >
                          </div>
                        </div>
                      </nz-card>
                    </div>
                  </div>
                </ng-container>
              </ng-template>
              <ng-template #noData>
                <div class="no-filters-message">
                  No Previous Filters Are Found
                </div>
              </ng-template>
            </div>
            <div nz-col [nzSpan]="24" class="filter-buttons-container">
              <button
                *ngIf="savedFilters && savedFilters.length > 0"
                nz-button
                nzType="primary"
                nzSize="small"
                (click)="Clearfilter()"
                class="reset-filter-btn"
              >
                <span nz-icon nzType="reload" nzTheme="outline"></span>
                Reset Filter
              </button>
              <button
                nz-button
                nzType="primary"
                nzSize="small"
                (click)="openfilter()"
                class="new-filter-btn"
              >
                <span nz-icon nzType="plus"></span>
                New Filter
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div nz-row>
    <div nz-col nzSpan="24">
      <nz-table
        class="my-scroll no-wrap1 data-table"
        nzBordered
        #organizationTable
        nzShowSizeChanger
        [nzFrontPagination]="false"
        [nzData]="dataList"
        [nzLoading]="loadingRecords"
        [nzTotal]="totalRecords"
        [(nzPageIndex)]="pageIndex"
        [(nzPageSize)]="pageSize"
        (nzPageIndexChange)="search()"
        (nzPageSizeChange)="search(true)"
        (nzQueryParams)="sort($event)"
        [nzSize]="'small'"
        [nzScroll]="{ y: '50vh' }"
      >
        <thead>
          <tr>
            <th nzWidth="100px" nzLeft class="view-jobs-header">View Jobs</th>
            <th
              nzLeft
              *ngIf="isColumnVisible('NAME')"
              nzWidth="300px"
              class="customer-name-header"
              nzColumnKey="NAME"
              [nzSortFn]="true"
              [nzFilterFn]="true"
              nzCustomFilter
            >
              Customer Name
              <nz-filter-trigger
                [(nzVisible)]="customerVisible"
                [nzDropdownMenu]="customer"
              >
                <span
                  nz-icon
                  nzType="filter"
                  nzTheme="fill"
                  [ngStyle]="{
                    color: isnameFilterApplied ? '#092B9C!important' : 'inherit'
                  }"
                  class="filter-icon"
                ></span>
              </nz-filter-trigger>
            </th>
            <th
              *ngIf="isColumnVisible('EMAIL')"
              nzWidth="250px"
              class="email-header"
              nzColumnKey="EMAIL"
              [nzSortFn]="true"
              [nzFilterFn]="true"
              nzCustomFilter
            >
              Email ID
              <nz-filter-trigger
                [(nzVisible)]="emailvisible"
                [nzDropdownMenu]="email"
              >
                <span
                  nz-icon
                  nzType="filter"
                  nzTheme="fill"
                  [ngStyle]="{
                    color: isemailFilterApplied
                      ? '#092B9C!important'
                      : 'inherit'
                  }"
                  class="filter-icon"
                ></span>
              </nz-filter-trigger>
            </th>
            <th
              *ngIf="isColumnVisible('MOBILE_NO')"
              nzWidth="150px"
              class="mobile-header"
              nzColumnKey="MOBILE_NO"
              [nzSortFn]="true"
              [nzFilterFn]="true"
              nzCustomFilter
            >
              Mobile No.
              <nz-filter-trigger
                [(nzVisible)]="mobilevisible"
                [nzDropdownMenu]="mobile"
              >
                <span
                  nz-icon
                  nzType="filter"
                  nzTheme="fill"
                  [ngStyle]="{
                    color: ismobileFilterApplied
                      ? '#092B9C!important'
                      : 'inherit'
                  }"
                  class="filter-icon"
                ></span>
              </nz-filter-trigger>
            </th>
            <th
              *ngIf="isColumnVisible('CUSTOMER_TYPE')"
              nzWidth="200px"
              class="customer-type-header"
              nzColumnKey="CUSTOMER_TYPE"
              [nzSortFn]="true"
              [nzFilters]="listOfFilter1"
              [nzFilterFn]="true"
              [nzFilterMultiple]="false"
              (nzFilterChange)="customertypeFilterChange($event)"
            >
              Customer Type
            </th>
            <th
              *ngIf="isColumnVisible('ACCOUNT_STATUS')"
              nzWidth="90px"
              class="status-header"
              nzColumnKey="ACCOUNT_STATUS"
              [nzSortFn]="true"
              [nzFilters]="listOfFilter"
              [nzFilterFn]="true"
              [nzFilterMultiple]="false"
              (nzFilterChange)="onStatusFilterChange($event)"
            >
              Status
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of organizationTable.data" class="table-row">
            <td nzLeft class="view-jobs-cell">
              <nz-tag
                nzColor="#2db7f5"
                (click)="viewJobs(data)"
                class="view-jobs-tag"
                nz-tooltip
                nzTooltipTitle="View Jobs"
              >
                <span
                  nz-icon
                  nzType="eye"
                  nzTheme="outline"
                  class="view-jobs-icon"
                >
                </span
                >&nbsp;&nbsp;View Jobs</nz-tag
              >
            </td>
            <td
              nzLeft
              align="left"
              *ngIf="isColumnVisible('NAME')"
              class="customer-name-cell"
            >
              <span *ngIf="data['NAME'] != null">
                <span
                  *ngIf="data['NAME'].length >= 42"
                  nz-popover
                  [nzPopoverContent]="data['NAME']"
                  nzPopoverPlacement="topLeft"
                  class="truncated-customer-name"
                >
                  {{
                    data["NAME"] == null
                      ? "-"
                      : (data["NAME"] | slice : 0 : 42)
                  }}{{ data["NAME"].length > 42 ? "..." : "" }}
                </span>
                <span
                  *ngIf="data['NAME'].length < 42"
                  class="full-customer-name"
                >
                  {{
                    data["NAME"] == null ? "-" : (data["NAME"] | slice : 0 : 42)
                  }}
                  {{ data["NAME"].length > 42 ? "..." : "" }}
                </span>
              </span>
              <span *ngIf="data['NAME'] == null" class="empty-value">-</span>
            </td>
            <td
              align="left"
              *ngIf="isColumnVisible('EMAIL')"
              class="email-cell"
            >
              <span *ngIf="data['EMAIL'] != null" class="email-content">
                <span
                  *ngIf="data['EMAIL'].length >= 50"
                  nz-popover
                  [nzPopoverContent]="data['EMAIL']"
                  nzPopoverPlacement="topLeft"
                  class="truncated-email"
                >
                  {{
                    data["EMAIL"] == null
                      ? "-"
                      : (data["EMAIL"] | slice : 0 : 50)
                  }}{{ data["EMAIL"].length > 50 ? "..." : "" }}
                </span>
                <span *ngIf="data['EMAIL'].length < 50" class="full-email">
                  {{
                    data["EMAIL"] == null
                      ? "-"
                      : (data["EMAIL"] | slice : 0 : 50)
                  }}
                  {{ data["EMAIL"].length > 50 ? "..." : "" }}
                </span>
              </span>
              <span *ngIf="data['EMAIL'] == null" class="empty-value-center"
                >-</span
              >
            </td>
            <td
              align="center"
              *ngIf="isColumnVisible('MOBILE_NO')"
              class="mobile-cell"
            >
              <span *ngIf="data['MOBILE_NO'] != null" class="mobile-content">
                {{ data.COUNTRY_CODE }}&nbsp;&nbsp;{{ data["MOBILE_NO"] }}
              </span>
              <span *ngIf="data['MOBILE_NO'] == null" class="empty-value"
                >-</span
              >
            </td>
            <td
              align="center"
              *ngIf="isColumnVisible('CUSTOMER_TYPE')"
              class="customer-type-cell"
            >
              <span
                *ngIf="data['CUSTOMER_TYPE'] != null"
                class="customer-type-content"
              >
                <span *ngIf="data.CUSTOMER_TYPE == 'I'">Individual(B2C)</span>
                <span *ngIf="data.CUSTOMER_TYPE == 'B'">Business(B2B)</span>
              </span>
              <span *ngIf="data['CUSTOMER_TYPE'] == null" class="empty-value"
                >-</span
              >
            </td>
            <td *ngIf="isColumnVisible('ACCOUNT_STATUS')" class="status-cell">
              <i
                nz-icon
                *ngIf="data['ACCOUNT_STATUS']"
                [nzType]="'check-circle'"
                [nzTheme]="'twotone'"
                [nzTwotoneColor]="'#52c41a'"
                class="status-icon-active"
              ></i>
              <i
                nz-icon
                *ngIf="!data['ACCOUNT_STATUS']"
                [nzType]="'close-circle'"
                [nzTheme]="'twotone'"
                [nzTwotoneColor]="'#f50'"
                class="status-icon-inactive"
              ></i>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>
<nz-dropdown-menu #showcolumn1="nzDropdownMenu">
  <ul nz-menu nzPlacement="bottomRight">
    <li nz-menu-item *ngFor="let column of showcolumn">
      <label
        nz-checkbox
        [(ngModel)]="column.visible"
        (ngModelChange)="isColumnVisible(column)"
      >
        {{ column.label }}
      </label>
    </li>
  </ul>
</nz-dropdown-menu>
<nz-dropdown-menu #customer="nzDropdownMenu">
  <div class="ant-table-filter-dropdown">
    <div class="search-box">
      <nz-input-group [nzSuffix]="inputClearTpl">
        <input
          type="text"
          nz-input
          [(ngModel)]="customertext"
          (keyup)="onKeyup($event)"
          (keydown.enter)="nameFilter()"
          placeholder="Search Customer Name"
          class="filter-search-input"
        />
      </nz-input-group>
      <ng-template #inputClearTpl>
        <span
          nz-icon
          class="ant-input-clear-icon"
          nzTheme="fill"
          nzType="close-circle"
          *ngIf="customertext"
          (click)="reset()"
          class="clear-filter-icon"
        ></span>
        <span
          nz-icon
          nzType="search"
          nzTheme="outline"
          *ngIf="customertext == ''"
          class="search-filter-icon"
        ></span>
      </ng-template>
    </div>
  </div>
</nz-dropdown-menu>
<nz-dropdown-menu #email="nzDropdownMenu">
  <div class="ant-table-filter-dropdown">
    <div class="search-box">
      <nz-input-group [nzSuffix]="inputClearTpl">
        <input
          type="text"
          nz-input
          [(ngModel)]="emailtext"
          (keyup)="onKeyup($event)"
          (keydown.enter)="emailFilter()"
          placeholder="Search Email ID"
          class="filter-search-input"
        />
      </nz-input-group>
      <ng-template #inputClearTpl>
        <span
          nz-icon
          class="ant-input-clear-icon"
          nzTheme="fill"
          nzType="close-circle"
          *ngIf="emailtext"
          (click)="reset1()"
          class="clear-filter-icon"
        ></span>
        <span
          nz-icon
          nzType="search"
          nzTheme="outline"
          *ngIf="emailtext == ''"
          class="search-filter-icon"
        ></span>
      </ng-template>
    </div>
  </div>
</nz-dropdown-menu>
<nz-dropdown-menu #mobile="nzDropdownMenu">
  <div class="ant-table-filter-dropdown">
    <div class="search-box">
      <nz-input-group [nzSuffix]="inputClearTpl">
        <input
          type="text"
          nz-input
          [(ngModel)]="mobiletext"
          (keyup)="onKeyup($event)"
          (keydown.enter)="mobileFilter()"
          placeholder="Search Mobile No."
          class="filter-search-input"
        />
      </nz-input-group>
      <ng-template #inputClearTpl>
        <span
          nz-icon
          class="ant-input-clear-icon"
          nzTheme="fill"
          nzType="close-circle"
          *ngIf="mobiletext"
          (click)="reset2()"
          class="clear-filter-icon"
        ></span>
        <span
          nz-icon
          nzType="search"
          nzTheme="outline"
          *ngIf="mobiletext == ''"
          class="search-filter-icon"
        ></span>
      </ng-template>
    </div>
  </div>
</nz-dropdown-menu>
<div *ngIf="drawerFilterVisible">
  <nz-drawer
    [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }"
    [nzClosable]="true"
    [nzMask]="true"
    [nzMaskClosable]="false"
    [nzWidth]="'70%'"
    [nzVisible]="drawerFilterVisible"
    [nzTitle]="drawerTitle"
    (nzOnClose)="drawerfilterClose('buttontype', 'updateButton')"
    (nzKeyboard)="(true)"
    [nzPlacement]="'right'"
  >
    <ng-container *nzDrawerContent>
      <app-main-filter
        [filterGroups]="filterGroups"
        [filterGroups2]="filterGroups2"
        [name]="FILTER_NAME"
        [data]="EditQueryData"
        [drawerClose]="closefilterCallback"
        [fields]="filterFields"
        [TabId]="TabId"
        [editButton]="editButton"
        (filterApplied)="onFilterApplied($event)"
        [filterData]="filterData"
      >
      </app-main-filter>
    </ng-container>
  </nz-drawer>
</div>
<nz-modal
  [(nzVisible)]="isModalVisible"
  [nzTitle]="'Filter Text'"
  [nzFooter]="null"
  (nzOnCancel)="handleCancel()"
  ><ng-container *nzModalContent>
    <h6 class="filter-text-display">{{ selectedQuery }}</h6>
  </ng-container>
</nz-modal>
<div *ngIf="viewJobsDrawerVisible">
  <nz-drawer
    [nzBodyStyle]="{
        height: 'calc(100% - 55px)',
        overflow: 'auto',
        padding: '10px',
      }"
    [nzClosable]="true"
    [nzMask]="true"
    [nzMaskClosable]="false"
    [nzWidth]="viewJobsWidth"
    [nzVisible]="viewJobsDrawerVisible"
    [nzTitle]="viewJobsdrawerTitle"
    (nzOnClose)="viewJobsdrawerClose()"
    (nzKeyboard)="(true)"
  >
    <ng-container *nzDrawerContent>
      <app-customersjobslist
        [drawerClose]="viewJobscloseCallback"
        [viewjobsdata]="viewjobsdata"
        [technicianId]="technicianId"
      >
      </app-customersjobslist>
    </ng-container>
  </nz-drawer>
</div>
