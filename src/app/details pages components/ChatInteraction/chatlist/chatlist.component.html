<div nz-row nzType="flex" class="header-row">
  <div nz-col nzXs="24" nzSm="24" nzMd="20" nzLg="20" nzXl="8">
    <div class="formname" *ngIf="TYPE == ''">
      <b> Backoffice-Technician Chat </b>
    </div>
  </div>
  <div
    nz-col
    nzXs="24"
    nzSm="24"
    nzMd="4"
    nzLg="6"
    nzXl="16"
    class="header-controls"
  >
    <form nz-form [nzLayout]="'inline'">
      <nz-form-item class="filter-button-container">
        <button
          nz-button
          (click)="showMainFilter()"
          nzTooltipTitle="Filter"
          nzTooltipPlacement="top"
          nz-tooltip
          [nzType]="isfilterapply ? 'primary' : 'default'"
          class="filter-toggle-btn"
        >
          <i nz-icon nzType="filter"></i>
        </button>
      </nz-form-item>
      <nz-form-item>
        <nz-input-group
          nzSearch
          [nzAddOnAfter]="suffixIconButton"
          class="search-input-group"
        >
          <input
            type="text"
            name="search"
            autocomplete="off"
            (keyup)="keyup($event)"
            (keydown.enter)="onEnterKey($event)"
            [(ngModel)]="searchText"
            nz-input
            placeholder="Min 3 chars required."
            class="search-input"
          />
        </nz-input-group>
        <ng-template #suffixIconButton>
          <button
            nz-button
            nzType="primary"
            (click)="search(true)"
            nzSearch
            class="search-btn"
          >
            <i nz-icon nzType="search"></i>
          </button>
        </ng-template>
      </nz-form-item>
    </form>
  </div>
</div>
<div nz-row>
  <div nz-col nzSpan="24">
    <div class="filter {{ filterClass }}">
      <div class="filter-box">
        <div nz-row class="filter-content-row">
          <div nz-col [nzSpan]="24">
            <ng-container *ngIf="filterloading; else filtersContent">
              <div class="filter-loading-container">
                <nz-spin nzSimple></nz-spin>
              </div>
            </ng-container>
            <ng-template #filtersContent>
              <ng-container
                *ngIf="savedFilters && savedFilters.length > 0; else noData"
              >
                <div nz-row nzGutter="8" class="filter-grid">
                  <div
                    nz-col
                    nzSpan="6"
                    *ngFor="let item of savedFilters"
                    class="filter-card-col"
                  >
                    <nz-card class="filter-card">
                      <div class="filter-card-header">
                        <span class="filter-name">
                          <span *ngIf="item.FILTER_NAME != null">
                            <span
                              *ngIf="item.FILTER_NAME.length >= 25"
                              nz-popover
                              [nzPopoverContent]="item.FILTER_NAME"
                              nzPopoverPlacement="topLeft"
                              class="truncated-filter-name"
                            >
                              {{ item.FILTER_NAME | slice : 0 : 25
                              }}{{ item.FILTER_NAME.length > 25 ? "..." : "" }}
                            </span>
                            <span
                              *ngIf="item.FILTER_NAME.length < 25"
                              class="full-filter-name"
                            >
                              {{ item.FILTER_NAME }}
                            </span>
                          </span>
                          <span
                            *ngIf="item.FILTER_NAME == null"
                            class="empty-filter-name"
                            >-</span
                          >
                        </span>
                        <i
                          *ngIf="selectedFilter === item.ID"
                          nz-icon
                          [nzType]="'check-circle'"
                          [nzTheme]="'twotone'"
                          [nzTwotoneColor]="'#52c41a'"
                          nz-tooltip
                          [nzTooltipTitle]="
                            'This filter is applied on current data'
                          "
                          class="filter-applied-icon"
                        ></i>
                      </div>
                      <div nz-row class="filter-actions-row">
                        <div nz-col nzSpan="24" class="filter-actions">
                          <nz-tag
                            nzColor="#2db7f5"
                            (click)="editQuery(item)"
                            class="filter-action-tag edit-tag"
                            nz-tooltip
                            nzTooltipTitle="Edit Filter"
                          >
                            <span
                              nz-icon
                              nzType="edit"
                              nzTheme="outline"
                              class="tag-icon"
                            >
                            </span
                            >&nbsp;&nbsp;Edit</nz-tag
                          >
                          <nz-tag
                            *ngIf="selectedFilter !== item.ID"
                            nzColor="#87d068"
                            (click)="applyfilter(item)"
                            class="filter-action-tag apply-tag"
                            nz-tooltip
                            nzTooltipTitle="Apply Filter"
                          >
                            <span
                              nz-icon
                              nzType="search"
                              nzTheme="outline"
                              class="tag-icon"
                            >
                            </span
                            >&nbsp;&nbsp;Apply</nz-tag
                          >
                          <nz-tag
                            *ngIf="selectedFilter === item.ID"
                            nzColor="#faad14"
                            (click)="Clearfilter()"
                            class="filter-action-tag clear-tag"
                            nz-tooltip
                            nzTooltipTitle="Clear this Filter"
                          >
                            <span
                              nz-icon
                              nzType="close"
                              nzTheme="outline"
                              class="tag-icon"
                            >
                            </span
                            >&nbsp;&nbsp;Clear</nz-tag
                          >
                          <nz-tag
                            nzColor="#cd201f"
                            nz-popconfirm
                            nzPopconfirmTitle="Are you sure to delete this record?"
                            nzPopconfirmPlacement="top"
                            (nzOnConfirm)="deleteItem(item)"
                            class="filter-action-tag delete-tag"
                            nz-tooltip
                            nzTooltipTitle="Delete Filter"
                          >
                            <span
                              nz-icon
                              nzType="delete"
                              nzTheme="outline"
                              class="tag-icon"
                            >
                            </span
                            >&nbsp;&nbsp;Delete</nz-tag
                          >
                          <nz-tag
                            nzColor="#3b5999"
                            class="filter-action-tag view-tag"
                            nz-tooltip
                            nzTooltipTitle="View Filter Text"
                            (click)="toggleLiveDemo(item)"
                          >
                            <span
                              nz-icon
                              nzType="eye"
                              nzTheme="outline"
                              class="tag-icon"
                            >
                            </span
                            >&nbsp;&nbsp;View</nz-tag
                          >
                        </div>
                      </div>
                    </nz-card>
                  </div>
                </div>
              </ng-container>
            </ng-template>
            <ng-template #noData>
              <div class="no-filters-message">
                No Previous Filters Are Found
              </div>
            </ng-template>
          </div>
          <div nz-col [nzSpan]="24" class="filter-buttons-container">
            <button
              nz-button
              nzType="primary"
              nzSize="small"
              (click)="Clearfilter()"
              class="reset-filter-btn"
            >
              <span nz-icon nzType="reload" nzTheme="outline"></span>
              Reset Filter
            </button>
            <button
              nz-button
              nzType="primary"
              nzSize="small"
              (click)="openfilter()"
              class="new-filter-btn"
            >
              <span nz-icon nzType="plus"></span>
              New Filter
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<nz-spin nzTip="Loading..." [nzSpinning]="isSpinning">
  <div nz-row *ngIf="dataList.length > 0" class="data-grid">
    <div
      nz-col
      nzSpan="8"
      *ngFor="let data of dataList; let i = index"
      class="data-card-col"
    >
      <div nz-row>
        <div nz-col nzSpan="24" class="cardstyle data-card">
          <div nz-row>
            <div class="mainnam" nz-col nzSpan="12" class="order-number-start">
              <span class="order-number-tag"> {{ data.ORDER_NUMBER }}</span>
            </div>
            <div
              class="mainnam"
              nz-col
              nzSpan="12"
              class="order-number-end"
            ></div>
            <div class="subnam" nz-col nzSpan="16" class="customer-name-info">
              <span
                *ngIf="data.CUSTOMER_TYPE == 'I'"
                nz-icon
                nzType="user"
                nzTheme="outline"
                class="user-icon"
              ></span>
              <svg
                *ngIf="data.CUSTOMER_TYPE != 'I'"
                class="business-icon"
                enable-background="new 0 0 48 48"
                height="17px"
                id="Layer_1"
                version="1.1"
                viewBox="0 0 48 48"
                width="17px"
                xml:space="preserve"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
              >
                <path
                  clip-rule="evenodd"
                  d="M6,47V20c0-2.209,1.791-4,4-4l0,0v-4c0-1.104,0.896-2,2-2h2V2c0-0.552,0.447-1,1-1  s1,0.448,1,1v8h2c1.104,0,2,0.896,2,2v4l0,0l0,0c2.209,0,4,1.791,4,4v8h7v-6h4v-3h6v3h1v25H6z M18,13c0-0.552-0.447-1-1-1h-4  c-0.553,0-1,0.448-1,1v3h6V13z M22,20c0-1.104-0.896-2-2-2H10c-1.104,0-2,0.896-2,2v25h14V20z M31,30h-7v15h7V30z M40,24h-7v21h7V24  z M36,27h1c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1h-1c-0.553,0-1-0.447-1-1v-1C35,27.447,35.447,27,36,27z M36,33h1  c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1h-1c-0.553,0-1-0.447-1-1v-1C35,33.447,35.447,33,36,33z M36,39h1c0.553,0,1,0.447,1,1v1  c0,0.553-0.447,1-1,1h-1c-0.553,0-1-0.447-1-1v-1C35,39.447,35.447,39,36,39z M27,33h1c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1  h-1c-0.553,0-1-0.447-1-1v-1C26,33.447,26.447,33,27,33z M27,39h1c0.553,0,1,0.447,1,1v1c0,0.553-0.447,1-1,1  h-1c-0.553,0-1-0.447-1-1v-1C26,39.447,26.447,39,27,39z M18,42h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1  v1C19,41.553,18.553,42,18,42z M18,36h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v1  C19,35.553,18.553,36,18,36z M18,30h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v1  C19,29.553,18.553,30,18,30z M18,24h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v1  C19,23.553,18.553,24,18,24z M13,42h-1c-0.553,0-1-0.447-1-1v-1c0-0.553,0.447-1,1-1h1c0.553,0,1,0.447,1,1v1  C14,41.553,13.553,42,13,42z M13,36h-1c-0.553,0-1-0.447-1-1v-1c0-0.553,0.447-1,1-1h1c0.553,0,1,0.447,1,1v1  C14,35.553,13.553,36,13,36z M13,30h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v1  C14,29.553,13.553,30,13,30z M13,24h-1c-0.553,0-1-0.447-1-1v-1c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v1  C14,23.553,13.553,24,13,24z"
                  fill-rule="evenodd"
                />
              </svg>
              {{ data.CUSTOMER_NAME }}
            </div>
            <div class="subnam" nz-col nzSpan="8" class="mobile-number-info">
              <span
                nz-icon
                nzType="mobile"
                nzTheme="outline"
                class="mobile-icon"
              ></span>
              <a class="mobile-link" href="tel:+9762417537">
                {{ data.MOBILE_NO }}</a
              >
            </div>
            <div nz-col nzSpan="24" class="address-container">
              <div nz-row>
                <div nz-col nzSpan="1" class="location-icon-wrapper">
                  <svg
                    viewBox="0 0 600 600"
                    xml:space="preserve"
                    xmlns="http://www.w3.org/2000/svg"
                    enable-background="new 0 0 512 512"
                    class="location-icon"
                  >
                    <path
                      d="M256.08 54.999c84.87 0 153.81 68.94 153.81 153.96 0 77.059-87.02 195.03-153.2 246.04-85.33-69.24-154.58-167.75-154.58-246.04 0-85.021 68.94-153.96 153.97-153.96zm74.79 150.799c0-41.34-33.521-74.86-74.87-74.86-41.35 0-74.86 33.52-74.86 74.86 0 41.35 33.51 74.87 74.86 74.87s74.87-33.52 74.87-74.87z"
                      fill="#ff1612"
                      class="fill-ff7979"
                    ></path>
                  </svg>
                </div>
                <div class="subnam" nz-col nzSpan="23" class="service-address">
                  <span
                    class="subnam service-address-text"
                    *ngIf="data['SERVICE_ADDRESS'] != null"
                  >
                    <span
                      class="service-address-truncated"
                      *ngIf="data['SERVICE_ADDRESS'].length >= 55"
                      nz-popover
                      [nzPopoverContent]="data['SERVICE_ADDRESS']"
                      nzPopoverPlacement="topLeft"
                    >
                      {{
                        data["SERVICE_ADDRESS"] == null
                          ? "-"
                          : (data["SERVICE_ADDRESS"] | slice : 0 : 55)
                      }}{{ data["SERVICE_ADDRESS"].length > 55 ? "..." : "" }}
                    </span>
                    <span
                      class="service-address-full"
                      *ngIf="data['SERVICE_ADDRESS'].length < 55"
                    >
                      {{
                        data["SERVICE_ADDRESS"] == null
                          ? "-"
                          : (data["SERVICE_ADDRESS"] | slice : 0 : 55)
                      }}
                      {{ data["SERVICE_ADDRESS"].length > 55 ? "..." : "" }}
                    </span>
                  </span>
                  <span
                    *ngIf="data['SERVICE_ADDRESS'] == null"
                    class="empty-address"
                    >-</span
                  >
                </div>
              </div>
            </div>
            <div
              lass="mainnam"
              nz-col
              nzSpan="24"
              class="chat-action-container"
            >
              <nz-tag
                [nzColor]="'#ff9d19'"
                (click)="openchat()"
                class="view-chat-tag"
                >View Chat</nz-tag
              >
            </div>
          </div>
        </div>
      </div>
    </div>
    <div nz-col nzSpan="24" class="load-more-container">
      <button
        *ngIf="totalRecords > dataList.length && dataList.length > 0"
        nz-button
        [nzLoading]="isSpinning"
        nzType="primary"
        (click)="loadMore()"
        class="load-more-btn"
      >
        Load More
      </button>
    </div>
  </div>
  <div *ngIf="dataList.length == 0" class="empty-state-container">
    <nz-empty></nz-empty>
  </div>
</nz-spin>
<div *ngIf="drawerFilterVisible">
  <nz-drawer
    [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }"
    [nzClosable]="true"
    [nzMask]="true"
    [nzMaskClosable]="false"
    [nzWidth]="'80%'"
    [nzVisible]="drawerFilterVisible"
    [nzTitle]="drawerTitle"
    (nzOnClose)="drawerflterClose('buttontype', 'updateButton')"
    (nzKeyboard)="(true)"
    [nzPlacement]="'right'"
  >
    <ng-container *nzDrawerContent>
      <app-order-filter
        [drawerClose]="closefilterCallback"
        [filterGroups]="filterGroups"
        [filterGroups2]="filterGroups2"
        (filterApplied)="onFilterApplied($event)"
        [TabId]="TabId"
        [fields]="filterFields"
        [filterData]="filterData"
      ></app-order-filter> </ng-container
  ></nz-drawer>
</div>
<nz-modal
  [(nzVisible)]="isModalVisible"
  [nzTitle]="'Filter Text'"
  [nzFooter]="null"
  (nzOnCancel)="handleCancel()"
  ><ng-container *nzModalContent>
    <h6 class="filter-text-display">{{ selectedQuery }}</h6>
  </ng-container>
</nz-modal>
<div *ngIf="chatdrawerVisible">
  <nz-drawer
    [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'hidden',
      padding: '10px',
      background: '#fff'
    }"
    [nzClosable]="true"
    [nzMask]="true"
    [nzMaskClosable]="false"
    [nzWidth]="400"
    [nzVisible]="chatdrawerVisible"
    [nzTitle]="chatdrawerTitle"
    (nzOnClose)="chatdrawerClose()"
    (nzKeyboard)="(true)"
  >
    <ng-container *nzDrawerContent>
      <app-chatdrawer
        [drawerClose]="chatcloseCallback"
        [chatdata]="orderDetails"
      >
      </app-chatdrawer>
    </ng-container>
  </nz-drawer>
</div>
