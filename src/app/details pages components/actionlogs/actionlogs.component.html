<div nz-row>
  <div nz-col nzSpan="3"></div>
  <div nz-col nzSpan="18">
    <div nz-row>
      <div nz-col nzSpan="12">
        <div class="formname" *ngIf="TYPE === ''">
          <span
            (click)="back()"
            nz-icon
            nzType="arrow-left"
            nzTheme="outline"
            class="back-icon"
          ></span>
          &nbsp;&nbsp;Activity Logs
        </div>
      </div>
      <div nz-col nzSpan="12">
        <div class="activity-action-container">
          <button
            *ngIf="TYPE != 'SHOP_ORDER'"
            nz-button
            nzTooltipTitle="Filter"
            [nzType]="isFilterApplied"
            nzTooltipPlacement="top"
            nz-tooltip
            (click)="showFilter()"
            class="filter-btn"
          >
            <i nz-icon nzType="filter"></i>
          </button>
        </div>
      </div>
    </div>
    <div nz-row>
      <div nz-col nzSpan="24">
        <div class="filter {{ filterClass }}">
          <div class="filter-box">
            <form nz-form>
              <div nz-row>
                <div nz-col nzSpan="8">
                  <nz-form-item class="form-item-gap">
                    <nz-form-label nzNoColon>Date</nz-form-label>
                    <nz-range-picker
                      class="full-width"
                      [nzFormat]="'dd/MM/yyyy'"
                      nzAllowClear="false"
                      [nzRanges]="ranges"
                      (nzOnCalendarChange)="changeDate($event)"
                      name="selectedDate"
                      [(ngModel)]="selectedDate"
                    ></nz-range-picker>
                  </nz-form-item>
                </div>
                <div
                  nz-col
                  nzSpan="8"
                  *ngIf="
                    TYPE != 'CUSTOMER' &&
                    TYPE != 'VENDOR' &&
                    TYPE != 'JOB' &&
                    TYPE != 'ORDER'
                  "
                >
                  <nz-form-item class="form-item-gap">
                    <nz-form-label nzNoColon>Customers</nz-form-label>
                    <nz-select
                      nzShowSearch
                      nzAllowClear
                      nzPlaceHolder="Select Customers"
                      name="Customerss"
                      [(ngModel)]="Customers"
                      class="full-width light-font"
                    >
                      <nz-option
                        *ngFor="let list of CustomersData"
                        [nzValue]="list.ID"
                        [nzLabel]="list.NAME"
                      ></nz-option>
                    </nz-select>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="8" *ngIf="TYPE != 'TECHNICIAN'">
                  <nz-form-item class="form-item-gap">
                    <nz-form-label nzNoColon>Technician</nz-form-label>
                    <nz-select
                      nzShowSearch
                      nzAllowClear
                      nzPlaceHolder="Select Technician"
                      name="Technicians"
                      [(ngModel)]="Technician"
                      class="full-width light-font"
                    >
                      <nz-option
                        *ngFor="let list of TechData"
                        [nzValue]="list.ID"
                        [nzLabel]="list.NAME"
                      ></nz-option>
                    </nz-select>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="8" *ngIf="TYPE != 'JOB'">
                  <nz-form-item class="form-item-gap">
                    <nz-form-label nzNoColon>Job</nz-form-label>
                    <nz-select
                      nzShowSearch
                      nzAllowClear
                      nzPlaceHolder="Select Job"
                      [(ngModel)]="JOB"
                      [nzOptionHeightPx]="80"
                      name="customerName"
                      class="full-width"
                    >
                      <nz-option
                        nzCustomContent
                        *ngFor="let customer of dataListOrder"
                        [nzValue]="customer.ID"
                        [nzLabel]="
                          customer.JOB_CARD_NO +
                          ' ' +
                          customer.SERVICE_FULL_NAME
                        "
                      >
                        <div nz-row>
                          <div nz-col nzSpan="12" class="job-service">
                            Service Name : {{ customer.SERVICE_FULL_NAME }}
                          </div>
                          <div nz-col nzSpan="24" class="job-no">
                            Job No.: {{ customer.JOB_CARD_NO }}
                          </div>
                        </div>
                      </nz-option>
                    </nz-select>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="8" *ngIf="TYPE == ''">
                  <nz-form-item class="form-item-gap">
                    <nz-form-label nzNoColon>Action Log Type</nz-form-label>
                    <nz-select
                      nzShowSearch
                      nzAllowClear
                      nzMode="multiple"
                      [nzMaxTagCount]="2"
                      nzPlaceHolder="Select Action Type"
                      name="actionlog"
                      [(ngModel)]="Actiontyoe"
                      class="full-width light-font"
                    >
                      <nz-option
                        nzValue="Order"
                        nzLabel="Order"
                        *ngIf="TYPE != 'ORDER'"
                      ></nz-option>
                      <nz-option
                        nzValue="Job"
                        nzLabel="Job"
                        *ngIf="TYPE != 'JOB'"
                      ></nz-option>
                      <nz-option
                        nzValue="Technician"
                        nzLabel="Technician"
                        *ngIf="TYPE != 'TECHNICIAN'"
                      ></nz-option>
                      <nz-option
                        nzValue="User"
                        nzLabel="User"
                        *ngIf="TYPE != 'TECHNICIAN'"
                      ></nz-option>
                      <nz-option nzValue="System" nzLabel="System"></nz-option>
                    </nz-select>
                  </nz-form-item>
                </div>
                <div nz-col nzSpan="8" class="filter-action-buttons">
                  <button
                    nz-button
                    nzType="primary"
                    [nzLoading]="isSpinning"
                    (click)="applyFilter()"
                  >
                    <i nz-icon nzType="filter"></i> Apply Filter
                  </button>
                  <button nz-button nzType="default" (click)="clearFilter()">
                    <i nz-icon nzType="delete"></i> Clear Filter
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <nz-divider></nz-divider>
    <nz-spin [nzSpinning]="loadactionlogs">
      <div class="timeline-container">
        <ng-container>
          <div *ngFor="let group of timelineData">
            <h3 class="group-date">{{ group.date | date : "dd/MM/yyyy" }}</h3>
            <nz-timeline>
              <nz-timeline-item *ngFor="let event of group.events">
                <div class="event-details">
                  <div class="event-title">
                    <span class="icon">{{ event.icon }}</span>
                    <span>{{ event.title }}</span>
                  </div>
                  <div class="event-meta">
                    <span class="time">{{ event.time }}</span>
                    <span class="user"
                      >By {{ event.user }}&nbsp;
                      <span class="log-type-wrapper">
                        (<span
                          *ngIf="
                            event.ACTION_LOG_TYPE == 'O' ||
                            event.ACTION_LOG_TYPE == 'Order' ||
                            event.ACTION_LOG_TYPE == 'order'
                          "
                          class="log-type"
                        >
                          Order Log</span
                        ><span
                          class="log-type"
                          *ngIf="
                            event.ACTION_LOG_TYPE == 'J' ||
                            event.ACTION_LOG_TYPE == 'Job'
                          "
                          >Job Log</span
                        >
                        <span
                          *ngIf="
                            event.ACTION_LOG_TYPE == 'T' ||
                            event.ACTION_LOG_TYPE == 'Technician' ||
                            event.ACTION_LOG_TYPE == 'Skill Request'
                          "
                          class="log-type"
                          >Technician Log</span
                        ><span
                          *ngIf="
                            event.ACTION_LOG_TYPE == 'C' ||
                            event.ACTION_LOG_TYPE == 'Customer'
                          "
                          class="log-type"
                          >Customer Log</span
                        >
                        <span
                          *ngIf="
                            event.ACTION_LOG_TYPE == 'User' ||
                            event.ACTION_LOG_TYPE == 'user'
                          "
                          class="log-type"
                          >User Log</span
                        ><span
                          *ngIf="event.ACTION_LOG_TYPE == 'System'"
                          class="log-type"
                          >System Log</span
                        >)</span
                      ></span
                    >
                  </div>
                </div>
              </nz-timeline-item>
            </nz-timeline>
          </div>
        </ng-container>
        <ng-template #loadingTemplate>
          <nz-spin>Loading timeline data...</nz-spin>
        </ng-template>
        <div
          nz-col
          nzXs="24"
          nzSm="24"
          nzMd="24"
          nzLg="24"
          nzXl="24"
          *ngIf="timelineData.length === 0"
          class="timeline-empty"
        >
          <nz-empty
            nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
            [nzNotFoundContent]="contentTpl"
            [nzNotFoundFooter]="footerTpl"
          >
            <ng-template #contentTpl>
              <span> Data Not Found</span>
            </ng-template>
            <ng-template #footerTpl> </ng-template>
          </nz-empty>
        </div>
      </div>
    </nz-spin>
    <div nz-col nzSpan="3"></div>
  </div>
</div>
