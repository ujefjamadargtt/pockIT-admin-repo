<div nz-row>
  <div nz-col nzSpan="4"></div>
  <div nz-col nzSpan="16">
    <div nz-row class="select-container" style="justify-content: end;">
      <div nz-col nzSpan="14">
        <div class="formname" *ngIf="TYPE==''">
          Chats History
        </div>
      </div>
      <div nz-col nzSpan="10">
        <nz-form-item style="margin-bottom: 10px;" [ngStyle]="{ display: TYPE == 'JOB' ? 'none' : 'block' }">
          <!-- <nz-form-label nzRequired nzNoColon>Select Job</nz-form-label> -->
          <nz-form-control nzHasFeedback nzErrorTip="Select Job">

            <nz-select nzShowSearch nzAllowClear style="width: 100%" nzPlaceHolder="Select Job" [(ngModel)]="JOB"
              [nzOptionHeightPx]="80" name="customerName" (ngModelChange)="onTechnicianChange($event)">
              <nz-option nzCustomContent *ngFor="let customer of dataListOrder" [nzValue]="customer.ID"
                [nzLabel]="customer.JOB_CARD_NO + ' ' + customer.SERVICE_NAME">
                <div nz-row>
                  <div nz-col nzSpan="12" style="font-size: 14px; color: #2D3748; font-weight: 500;">

                    Service Name : {{ customer.SERVICE_NAME }}
                  </div>
                  <div nz-col nzSpan="24" style="font-size: 12px; color: #4A5568;">

                    Job No.: {{ customer.JOB_CARD_NO }}
                  </div>
                </div>
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <nz-spin [nzSpinning]="loaddata">

      <div class="chat-container" *ngIf="chantcount>0 else elseblock; ">
        <!-- Scrollable area for messages -->
        <div class="message-box" style="background-image: url('/assets/chat.png');
        background-repeat: repeat;background-size: cover;" *ngIf="TYPE=='TECHNICIAN' else elsetechBlock">
          <div *ngFor="let data of chatDetailsdata">
            <!-- Customer's message -->
            <div class="message customer-message" *ngIf="data.BY_CUSTOMER">
              <span class="customer-name" *ngIf="chatDetailsdata!=undefined">{{data.CUSTOMER_NAME}}</span>
              <div>
                <div class="box33 sb13" *ngIf="chatDetailsdata!=undefined">
                  {{ data.MESSAGE }}
                  <div *ngIf="
                    data['ATTACHMENT_URL'] != null &&
                    data['ATTACHMENT_URL'] != '' &&
                    data['ATTACHMENT_URL'] != undefined
                  ">
                    <img *ngIf="data['MEDIA_TYPE']=='I' else elsevblock2;" nz-image width="100%" height="50px"
                      nzSrc="{{ urllll }}OrderChat/{{data['ATTACHMENT_URL']}}" alt="" />
                    <ng-template #elsevblock2>
                      <video width="100%" height="100px" controls>
                        <source src="{{ urllll }}OrderChat/{{
                            data['ATTACHMENT_URL']
                          }}" />
                      </video>
                    </ng-template>

                  </div>
                </div>
                <div class="timestamp" *ngIf="chatDetailsdata!=undefined">{{data.SEND_DATE | date: 'dd/MM/yy HH:mm a'}}
                </div>
              </div>
            </div>

            <!-- Technician's message -->
            <div class="message technician-message" *ngIf="!data.BY_CUSTOMER">
              <span class="technician-name" *ngIf="chatDetailsdata!=undefined">{{ data.TECHNICIAN_NAME }}</span>
              <div class="box3 sb14" *ngIf="chatDetailsdata!=undefined">
                {{ data.MESSAGE }}
                <div *ngIf="
                    data['ATTACHMENT_URL'] != null &&
                    data['ATTACHMENT_URL'] != '' &&
                    data['ATTACHMENT_URL'] != undefined
                  ">
                  <img *ngIf="data['MEDIA_TYPE']=='I' else elsevblock1;" nz-image width="100%" height="50px"
                    nzSrc="{{ urllll }}OrderChat/{{data['ATTACHMENT_URL']}}" alt="" />
                  <ng-template #elsevblock1>
                    <video width="100%" height="100px" controls>
                      <source src="{{ urllll }}OrderChat/{{
                            data['ATTACHMENT_URL']
                          }}" />
                    </video>
                  </ng-template>

                </div>
              </div>
              <span class="timestamp" *ngIf="chatDetailsdata!=undefined">{{data.SEND_DATE | date: 'dd/MM/yy HH:mm
                a'}}</span>
            </div>


          </div>
        </div>
        <ng-template #elsetechBlock>
          <div class="message-box" style="background-image: url('/assets/chat.png');
        background-repeat: repeat;background-size: cover;">
            <div *ngFor="let data of chatDetailsdata">
              <!-- Customer's message -->
              <div class="message customer-message" *ngIf="!data.BY_CUSTOMER">
                <span class="customer-name" *ngIf="chatDetailsdata!=undefined">{{data.TECHNICIAN_NAME}}</span>
                <div>
                  <div class="box33 sb13" *ngIf="chatDetailsdata!=undefined">
                    {{ data.MESSAGE }}
                    <div *ngIf="
                    data['ATTACHMENT_URL'] != null &&
                    data['ATTACHMENT_URL'] != '' &&
                    data['ATTACHMENT_URL'] != undefined
                  ">
                      <img *ngIf="data['MEDIA_TYPE']=='I' else elsevblock;" nz-image width="100%" height="50px"
                        nzSrc="{{ urllll }}OrderChat/{{data['ATTACHMENT_URL']}}" alt="" />
                      <ng-template #elsevblock>
                        <video width="100%" height="100px" controls>
                          <source src="{{ urllll }}OrderChat/{{
                            data['ATTACHMENT_URL']
                          }}" />
                        </video>
                      </ng-template>

                    </div>
                  </div>
                  <div class="timestamp" *ngIf="chatDetailsdata!=undefined">{{data.SEND_DATE | date: 'dd/MM/yy HH:mm
                    a'}}
                  </div>
                </div>
              </div>

              <!-- Technician's message -->
              <div class="message technician-message" *ngIf="data.BY_CUSTOMER">
                <span class="technician-name" *ngIf="chatDetailsdata!=undefined">{{ data.CUSTOMER_NAME }}</span>
                <div class="box3 sb14" *ngIf="chatDetailsdata!=undefined">
                  <!-- {{ data.MESSAGE }} -->
                  <div [innerHTML]="transform(data['MESSAGE'])"></div>

                  <div *ngIf="
                    data['ATTACHMENT_URL'] != null &&
                    data['ATTACHMENT_URL'] != '' &&
                    data['ATTACHMENT_URL'] != undefined
                  ">
                    <img *ngIf="data['MEDIA_TYPE']=='I' else elsevblocsk;" nz-image width="100%" height="50px"
                      nzSrc="{{ urllll }}OrderChat/{{ data['ATTACHMENT_URL'] }}" alt="" />
                    <ng-template #elsevblocsk>
                      <video width="100%" height="100px" controls>
                        <source src="{{ urllll }}OrderChat/{{
                            data['ATTACHMENT_URL']
                          }}" />
                      </video>
                    </ng-template>
                  </div>
                </div>
                <span class="timestamp" *ngIf="chatDetailsdata!=undefined">{{data.SEND_DATE | date: 'dd/MM/yy HH:mm
                  a'}}</span>
              </div>


            </div>
          </div>
        </ng-template>
      </div>

      <ng-template #elseblock>
        <div nz-row style="height: 50vh;width: 100% !important;">
          <div nz-col nzSpan="24" style="display: flex;justify-content: center;align-items: center;">
            <nz-empty nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
              [nzNotFoundContent]="contentTpl43" [nzNotFoundFooter]="footerTpl43" style="margin-top: 38px">
              <ng-template #contentTpl43>
                <span> Data Not Found</span>
              </ng-template>
              <ng-template #footerTpl43>
              </ng-template>
            </nz-empty>
          </div>
        </div>
      </ng-template>
    </nz-spin>

  </div>
  <div nz-col nzSpan="4"></div>
</div>