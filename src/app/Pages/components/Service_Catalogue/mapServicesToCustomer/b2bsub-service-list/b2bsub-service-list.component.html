<div nz-row nzType="flex">
  <div nz-col nzSpan="24" class="search-filter-container">
    <form nz-form nzLayout="inline">
      <nz-form-item class="filter-button-container">
        <button nz-button nzTooltipTitle="Filter" nzTooltipPlacement="top" nz-tooltip
          [nzType]="isfilterapply ? 'primary' : 'default'" [style.backgroundColor]="isfilterapply ? 'default' : ''"
          (click)="showMainFilter()">
          <i nz-icon nzType="filter"></i>
        </button>
      </nz-form-item>
      <nz-form-item>
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
          <input type="text" name="search" nz-input placeholder="Min 3 chars required." [(ngModel)]="searchText"
            (keyup)="onKeypressEvent($event)" />
        </nz-input-group>
      </nz-form-item>
      <ng-template #suffixIconButton>
        <button nz-button nzType="primary" id="button" nzSearch (click)="searchopen()">
          <i nz-icon nzType="search"></i>
        </button>
      </ng-template>
      <nz-form-item class="new-subservice-button-container">
        <button nz-button nzType="primary" (click)="add()" nzJustify="end">
          <i nz-icon nzType="plus"></i>New Sub Service
        </button>
      </nz-form-item>
    </form>
  </div>
</div>
<div nz-row>
  <div nz-col nzSpan="24">
    <div class="filter {{ filterClass }}">
      <div class="filter-box">
        <div nz-row class="filter-content-row">
          <div nz-col [nzSpan]="24">
            <div class="filter-tags-container">
              <ng-container *ngIf="filterloading; else filtersContent">
                <div class="spin-container">
                  <nz-spin nzSimple></nz-spin>
                </div>
              </ng-container>
              <ng-template #filtersContent>
                <ng-container *ngIf="savedFilters && savedFilters.length > 0; else noData">
                  <ng-container *ngFor="let item of savedFilters">
                    <nz-tag [style.backgroundColor]="
                        selectedFilter === item.ID ? '#e6f7ff' : 'white'
                      " class="filter-tag-item">
                      <span class="filter-tag-name">{{ item.FILTER_NAME }}</span>
                      <span class="filter-tag-actions">
                        <i nz-icon nzType="search" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Apply Filter'"
                          (click)="applyfilter(item)" class="filter-action-icon apply-icon"></i>
                        <i nz-icon nzType="delete" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Delete'"
                          class="filter-action-icon delete-icon" nz-popconfirm
                          nzPopconfirmTitle="Are you sure to delete this record?" nzPopconfirmPlacement="top"
                          (nzOnConfirm)="deleteItem(item)">
                        </i>
                        <i nz-icon nzType="eye" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Show Query'"
                          (click)="toggleLiveDemo(item)" class="filter-action-icon view-icon"></i>
                      </span>
                    </nz-tag>
                  </ng-container>
                </ng-container>
              </ng-template>
              <ng-template #noData>
                <div class="no-filters-message">
                  No Previous Filters Are Found
                </div>
              </ng-template>
            </div>
          </div>
          <div nz-col [nzSpan]="24" class="filter-buttons-container">
            <button *ngIf="savedFilters && savedFilters.length > 0" nz-button nzType="primary" nzSize="small"
              (click)="Clearfilter()" class="clear-filter-button">
              Clear Applied Filter
            </button>
            <button nz-button nzType="primary" nzSize="small" (click)="openfilter()" class="add-filter-button">
              Add New Filter
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div nz-row *ngIf="totalRecords > 0">
  <div nz-col nzSpan="8" *ngFor="let data of dataList">
    <div class="service-card-wrapper">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col-7">
              <div class="category-container">
                <span class="category-name"><span *ngIf="dataList != undefined && data['SERVICE_NAME']">
                    <span class="truncate-one-line" nz-popover [nzPopoverContent]="data['SERVICE_NAME']"
                      nzPopoverPlacement="topLeft">
                      {{ data["SERVICE_NAME"] }}
                    </span>
                  </span>
                </span>
              </div>
            </div>
            <div class="col-5 status-container">
              <div>
                <i nz-icon *ngIf="dataList != undefined && data['STATUS']" class="status-icon"
                  [nzType]="'check-circle'" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'"></i>
                <i nz-icon class="status-icon" *ngIf="dataList != undefined && !data['STATUS']"
                  [nzType]="'close-circle'" [nzTheme]="'twotone'" [nzTwotoneColor]="'#f50'"></i>&nbsp;&nbsp;<nz-tag
                  *ngIf="dataList != undefined && data['IS_EXPRESS']" class="express-tag" nzColor="volcano">Express Service</nz-tag>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="info">
            <div class="row">
              <div class="col-8">
                <div class="details">
                  <h4 class="service-name">
                    <span *ngIf="dataList != undefined && data['NAME']">
                      <span class="truncate-one-line" nz-popover [nzPopoverContent]="data['NAME']"
                        nzPopoverPlacement="topLeft">
                        {{ data["NAME"] }}
                      </span>
                    </span>
                    <span *ngIf="dataList != undefined && !data['NAME']">-</span>
                  </h4>
                  <p class="service-description">
                    <span *ngIf="dataList != undefined && data['DESCRIPTION']">
                      <span class="truncate-three-lines" nz-popover [nzPopoverContent]="data['DESCRIPTION']"
                        nzPopoverPlacement="topLeft" nzPopoverOverlayClassName="custom-popover">
                        {{ data["DESCRIPTION"] }}
                      </span>
                    </span>
                    <span *ngIf="dataList != undefined && !data['DESCRIPTION']">-</span>
                  </p>
                  <div class="row price-row">
                    <div class="col-6 price-col" *ngIf="
                        data != undefined &&
                        (data.SERVICE_TYPE == 'O' || data.SERVICE_TYPE == 'C')
                      ">
                      B2C :
                      <span *ngIf="dataList != undefined" class="price-value">₹{{ data.B2C_PRICE
                        }}</span>
                    </div>
                    <div class="col-6 price-col" *ngIf="
                        data != undefined &&
                        (data.SERVICE_TYPE == 'O' || data.SERVICE_TYPE == 'B')
                      ">
                      B2B :
                      <span *ngIf="dataList != undefined" class="price-value">₹{{ data.B2B_PRICE
                        }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4">
                <div class="service-image">
                  <img [src]="SERVER_URL + data.SERVICE_IMAGE" width="128px" height="100px" alt="Service Image" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <div class="row footer-buttons-row">
            <div class="col-2 footer-button-col edit-button-col">
              <button class="btn edit-details-button" (click)="edit(data)">
                <span nz-icon nzType="edit" nzTheme="outline"></span>&nbsp; Edit
              </button>
            </div>
            <div class="col-4 footer-button-col helpdoc-button-col">
              <button class="btn helpdoc-button" (click)="HelpDocMap(data)">
                Help Document
              </button>
            </div>
            <div class="col-3 footer-button-col map-button-col">
              <button class="btn map-skill-button" (click)="mapSkill(data)">
                Map Skills
              </button>
            </div>
            <div class="col-3 footer-button-col changelog-button-col">
              <button class="btn change-logs-button" (click)="VieMappedServices(data)">
                Change Logs
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div nz-row *ngIf="totalRecords == 0" class="empty-state-container">
  <div nz-col nzSpan="24" class="empty-state-content">
    <nz-empty nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
      [nzNotFoundContent]="contentTpl43" [nzNotFoundFooter]="footerTpl43">
      <ng-template #contentTpl43>
        <span> Data Not Found</span>
      </ng-template>
      <ng-template #footerTpl43> </ng-template>
    </nz-empty>
  </div>
</div>
<div *ngIf="drawerVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '3px',
      'padding-left': '20px',
      'padding-right': '20px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widths" [nzVisible]="drawerVisible"
    [nzTitle]="drawerTitle" (nzOnClose)="drawerClose()" (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-b2bsub-service-form [drawerClose]="closeCallback" [drawerVisible]="drawerVisible" [sername]="sername"
        [data]="drawerData" [parentId]="parentId" [dataMain]="dataMain" [custid]="custid">
      </app-b2bsub-service-form>
    </ng-container>
  </nz-drawer>
</div>
<nz-modal [nzWidth]="900" [(nzVisible)]="ImageModalVisible" nzMaskClosable="false" nzClosable="false"
  [nzContent]="content" [nzTitle]="'Image View'" (nzOnCancel)="ImageModalCancel()" [nzFooter]="ImageModalFooter">
  <ng-template #content>
    <nz-spin [nzSpinning]="loadingRecords">
      <div *ngIf="imageshow != undefined && imageshow != null && imageshow != ''" class="image-modal-content">
        <iframe [src]="imageshow" class="image-iframe" frameborder="0"></iframe>
      </div>
    </nz-spin>
  </ng-template>
  <ng-template #ImageModalFooter>
    <button nz-button nzType="default" (click)="ImageModalCancel()">
      Close
    </button>
  </ng-template>
</nz-modal>
<div *ngIf="drawerMappigVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '17px',
      'padding-right': '17px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsSkill"
    [nzVisible]="drawerMappigVisible" [nzTitle]="drawerMappingTitle" (nzOnClose)="draweMappingClose()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-skill-mapping [drawerClose]="closeCallbackMapping" [Type]="'Main'" [drawerVisible]="drawerMappigVisible"
        [data]="drawerData">
      </app-skill-mapping>
    </ng-container>
  </nz-drawer>
</div>
<div *ngIf="drawerVisibleDesigner">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '20px',
      'padding-right': '20px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widths11"
    [nzVisible]="drawerVisibleDesigner" [nzTitle]="drawerTitleDesigner" (nzOnClose)="drawerClosedesigner()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-add-details-drawer-main [closeCallbacksubDesigner]="closeCallbacksubDesigner"
        [drawerVisibleDesigner]="drawerVisibleDesigner" [dataDesigner]="dataDesigner">
      </app-add-details-drawer-main>
    </ng-container>
  </nz-drawer>
</div>
<div *ngIf="drawerMappigVisibleHelp">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '17px',
      'padding-right': '17px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsDoc"
    [nzVisible]="drawerMappigVisibleHelp" [nzTitle]="drawerMappingTitleHelp" (nzOnClose)="draweMappingCloseHelp()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-map-help-documents [drawerClose]="HelpcloseCallbackMapping" [type]="'MAIN'"
        [drawerVisible]="drawerMappigVisibleHelp" [data]="drawerData">
      </app-map-help-documents>
    </ng-container>
  </nz-drawer>
</div>
<div *ngIf="drawerserviceVisibleMaped">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(105% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsss"
    [nzVisible]="drawerserviceVisibleMaped" [nzTitle]="drawerTitleMaped" (nzOnClose)="drawerServiceMappingCloseMaped()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-view-service-logs [drawerCloset]="closeServiceMappingCallbackMaped" [type]="'B2B'"
        [drawerVisiblet]="drawerserviceVisibleMaped" [serviceid]="serviceid"
        [data]="drawerDataMaped"></app-view-service-logs>
    </ng-container>
  </nz-drawer>
</div>
<div *ngIf="drawerFilterVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="'70%'" [nzVisible]="drawerFilterVisible"
    [nzTitle]="drawerTitle" (nzOnClose)="drawerfilterClose()" (nzKeyboard)="(true)" [nzPlacement]="'right'">
    <ng-container *nzDrawerContent>
      <app-main-filter [drawerClose]="filtercloseCallback" [filterGroups]="[]" [TabId]="TabId" [fields]="filterFields"
        (filterApplied)="onFilterApplied($event)"></app-main-filter> </ng-container></nz-drawer>
</div>
<nz-modal [(nzVisible)]="isModalVisible" [nzTitle]="'Query Details'" [nzFooter]="null"
  (nzOnCancel)="handleCancel()"><ng-container *nzModalContent>
    <h6 class="query-details-content">{{ selectedQuery }}</h6>
  </ng-container>
</nz-modal>