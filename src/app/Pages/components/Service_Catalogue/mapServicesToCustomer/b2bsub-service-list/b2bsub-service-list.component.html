<div nz-row nzType="flex">
  <div nz-col nzSpan="24" style="display: flex; justify-content: flex-end; margin-top: 15px">
    <form nz-form nzLayout="inline">
      <nz-form-item style="width: 47px">
        <button nz-button nzTooltipTitle="Filter" nzTooltipPlacement="top" nz-tooltip
          [nzType]="isfilterapply ? 'primary' : 'default'" [style.backgroundColor]="isfilterapply ? 'default' : ''"
          (click)="showMainFilter()">
          <i nz-icon nzType="filter"></i>
        </button>
      </nz-form-item>

      <nz-form-item>
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
          <input type="text" name="search" nz-input placeholder="Min 3 chars required." [(ngModel)]="searchText"
            (keyup)="onKeypressEvent($event)" />
        </nz-input-group>
      </nz-form-item>

      <ng-template #suffixIconButton>
        <button nz-button nzType="primary" id="button" nzSearch (click)="searchopen()">
          <i nz-icon nzType="search"></i>
        </button>
      </ng-template>

      <nz-form-item style="margin-right: 0px">
        <button nz-button nzType="primary" (click)="add()" nzJustify="end">
          <i nz-icon nzType="plus"></i>New Sub Service
        </button>
      </nz-form-item>
    </form>
  </div>
</div>

<!-- Main Filter -->
<div nz-row>
  <div nz-col nzSpan="24">
    <div class="filter {{ filterClass }}">
      <div class="filter-box">
        <div nz-row style="padding-top: 10px">
          <div nz-col [nzSpan]="24">
            <div style="
                border: 1px dashed black;
                border-radius: 5px;
                padding: 10px;
              ">
              <ng-container *ngIf="filterloading; else filtersContent">
                <div style="text-align: center">
                  <nz-spin nzSimple></nz-spin>
                </div>
              </ng-container>
              <ng-template #filtersContent>
                <ng-container *ngIf="savedFilters && savedFilters.length > 0; else noData">
                  <ng-container *ngFor="let item of savedFilters">
                    <nz-tag [style.backgroundColor]="
                        selectedFilter === item.ID ? '#e6f7ff' : 'white'
                      " style="
                        margin: 5px;
                        display: inline-flex;
                        align-items: center;

                        background-color: white;
                      ">
                      <span style="color: black; margin-right: 10px">{{
                        item.FILTER_NAME
                        }}</span>
                      <span>
                        <i nz-icon nzType="search" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Apply Filter'"
                          (click)="applyfilter(item)" style="color: #01ac5c; margin-right: 8px"></i>
                        <i nz-icon nzType="delete" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Delete'"
                          style="color: red; margin-right: 8px" nz-popconfirm
                          nzPopconfirmTitle="Are you sure to delete this record?" nzPopconfirmPlacement="top"
                          (nzOnConfirm)="deleteItem(item)">
                        </i>
                        <i nz-icon nzType="eye" nzTheme="outline" nz-tooltip [nzTooltipTitle]="'Show Query'"
                          (click)="toggleLiveDemo(item)" style="color: blue"></i>
                      </span>
                    </nz-tag>
                  </ng-container>
                </ng-container>
              </ng-template>
              <ng-template #noData>
                <div style="text-align: center; color: red; font-weight: bold">
                  No Previous Filters Are Found
                </div>
              </ng-template>
            </div>
          </div>
          <div nz-col [nzSpan]="24" style="
              display: flex;
              justify-content: flex-end;
              align-items: left;
              margin-top: 10px;
            ">
            <button *ngIf="savedFilters && savedFilters.length > 0" nz-button nzType="primary" nzSize="small"
              (click)="Clearfilter()" style="margin-right: 10px">
              Clear Applied Filter
            </button>
            <button nz-button nzType="primary" nzSize="small" (click)="openfilter()" style="margin-right: 10px">
              Add New Filter
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Main Filter -->

<!-- Table -->
<div nz-row *ngIf="totalRecords > 0">
  <div nz-col nzSpan="8" *ngFor="let data of dataList">
    <div style="padding: 5px">
      <div class="card">
        <div class="card-header">
          <div class="row">
            <div class="col-7">
              <div class="category" style="padding: 4px 0px 0px 9px">
                <span class="category-name"><span *ngIf="dataList != undefined && data['SERVICE_NAME']">
                    <span class="truncate-one-line" nz-popover [nzPopoverContent]="data['SERVICE_NAME']"
                      nzPopoverPlacement="topLeft">
                      {{ data["SERVICE_NAME"] }}
                    </span>
                  </span>
                </span>
              </div>
            </div>
            <div class="col-5" style="text-align: end">
              <div>
                <i nz-icon *ngIf="dataList != undefined && data['STATUS']" style="font-size: 15px"
                  [nzType]="'check-circle'" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'"></i>
                <!-- nzTooltipTitle="Status" nz-tooltip -->
                <i nz-icon style="font-size: 15px" *ngIf="dataList != undefined && !data['STATUS']"
                  [nzType]="'close-circle'" [nzTheme]="'twotone'" [nzTwotoneColor]="'#f50'"></i>&nbsp;&nbsp;<nz-tag
                  *ngIf="dataList != undefined && data['IS_EXPRESS']" class="tag" style="margin: 0px !important"
                  nzColor="volcano">Express Service</nz-tag>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="info">
            <div class="row">
              <div class="col-8">
                <div class="details" style="height: 102px">
                  <!-- Name Section -->
                  <h4 class="name">
                    <span *ngIf="dataList != undefined && data['NAME']">
                      <span class="truncate-one-line" nz-popover [nzPopoverContent]="data['NAME']"
                        nzPopoverPlacement="topLeft">
                        {{ data["NAME"] }}
                      </span>
                    </span>
                    <span *ngIf="dataList != undefined && !data['NAME']">-</span>
                  </h4>

                  <!-- Description Section -->
                  <p class="description">
                    <span *ngIf="dataList != undefined && data['DESCRIPTION']">
                      <span class="truncate-three-lines" nz-popover
                        style="text-align: justify; font-size: 11px !important" [nzPopoverContent]="data['DESCRIPTION']"
                        nzPopoverPlacement="topLeft" nzPopoverOverlayClassName="custom-popover">
                        {{ data["DESCRIPTION"] }}
                      </span>
                    </span>
                    <span *ngIf="dataList != undefined && !data['DESCRIPTION']">-</span>
                  </p>
                  <div class="row" style="margin-top: 5px">
                    <div class="col-6" style="font-size: 11px !important; font-weight: 500" *ngIf="
                        data != undefined &&
                        (data.SERVICE_TYPE == 'O' || data.SERVICE_TYPE == 'C')
                      ">
                      B2C :
                      <span *ngIf="dataList != undefined" style="font-size: 11px !important">₹{{ data.B2C_PRICE
                        }}</span>
                    </div>
                    <div class="col-6" style="font-size: 11px !important; font-weight: 500" *ngIf="
                        data != undefined &&
                        (data.SERVICE_TYPE == 'O' || data.SERVICE_TYPE == 'B')
                      ">
                      B2B :
                      <span *ngIf="dataList != undefined" style="font-size: 11px !important">₹{{ data.B2B_PRICE
                        }}</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4">
                <div class="service-image">
                  <img [src]="SERVER_URL + data.SERVICE_IMAGE" width="128px" height="100px" alt="Service Image" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer" style="padding: 5px">
          <div class="row">
            <div class="col-2" style="padding-right: 3px">
              <button class="btn edit-details" style="width: 100%; font-size: 11px !important" (click)="edit(data)">
                <span nz-icon nzType="edit" nzTheme="outline"></span>&nbsp; Edit
              </button>
            </div>
            <!-- <div class="col-3" style="padding: 0px 3px;">
                            <button class="btn edit" style="width: 100%;font-size: 11px !important;"
                                (click)="opendetailsDrawer(data)">
                                <span nz-icon nzType="edit" nzTheme="outline"></span>&nbsp; Edit Details
                            </button>
                        </div> -->
            <div class="col-4" style="padding: 0px 3px">
              <button class="btn helpdoc" style="width: 100%; font-size: 11px !important" (click)="HelpDocMap(data)">
                Help Document
              </button>
            </div>
            <div class="col-3" style="padding: 0px 3px">
              <button class="btn editmap" style="width: 100%; font-size: 11px !important" (click)="mapSkill(data)">
                Map Skills
              </button>
            </div>
            <div class="col-3" style="padding-left: 3px">
              <button class="btn edit" style="width: 100%; font-size: 11px !important"
                (click)="VieMappedServices(data)">
                Change Logs
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div nz-row *ngIf="totalRecords == 0" style="height: 75vh">
  <div nz-col nzSpan="24" style="display: flex; justify-content: center; align-items: center">
    <nz-empty nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
      [nzNotFoundContent]="contentTpl43" [nzNotFoundFooter]="footerTpl43" style="margin-top: 38px">
      <ng-template #contentTpl43>
        <span> Data Not Found</span>
      </ng-template>
      <ng-template #footerTpl43> </ng-template>
    </nz-empty>
  </div>
</div>

<!--Drawer-->
<div *ngIf="drawerVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '3px',
      'padding-left': '20px',
      'padding-right': '20px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widths" [nzVisible]="drawerVisible"
    [nzTitle]="drawerTitle" (nzOnClose)="drawerClose()" (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-b2bsub-service-form [drawerClose]="closeCallback" [drawerVisible]="drawerVisible" [sername]="sername"
        [data]="drawerData" [parentId]="parentId" [dataMain]="dataMain" [custid]="custid">
      </app-b2bsub-service-form>
    </ng-container>
  </nz-drawer>
</div>

<!-- <div *ngIf="drawerVisible1">
    <nz-drawer
      [nzBodyStyle]="{
        height: 'calc(100% - 55px)',
        overflow: 'auto',
        'padding-bottom': '53px','padding-top': '3px','padding-left': '20px','padding-right': '20px'
      }"
      [nzClosable]="true"
      [nzMask]="true"
      [nzMaskClosable]="false"
      [nzWidth]="widths1"
      [nzVisible]="drawerVisible1"
      [nzTitle]="drawerTitle1"
      (nzOnClose)="drawerCloseSubservice()"
      (nzKeyboard)="(true)"
    >
      <ng-container *nzDrawerContent>
        <app-sub-service-list
          [drawerClose]="closeCallbacksubservice"
          [drawerVisible1]="drawerVisible1"
          [data]="drawerData1"
        >
        </app-sub-service-list>
      </ng-container>
    </nz-drawer>
  </div> -->

<nz-modal [nzWidth]="900" [(nzVisible)]="ImageModalVisible" nzMaskClosable="false" nzClosable="false"
  [nzContent]="content" [nzTitle]="'Image View'" (nzOnCancel)="ImageModalCancel()" [nzFooter]="ImageModalFooter">
  <ng-template #content>
    <nz-spin [nzSpinning]="loadingRecords">
      <div *ngIf="imageshow != undefined && imageshow != null && imageshow != ''" class="ss"
        style="height: 400px; overflow: auto">
        <iframe [src]="imageshow" style="width: 832px; height: 396px" frameborder="0"></iframe>
      </div>
    </nz-spin>
  </ng-template>
  <ng-template #ImageModalFooter>
    <button nz-button nzType="default" (click)="ImageModalCancel()">
      Close
    </button>
  </ng-template>
</nz-modal>

<!-- Mapping Drawer -->
<div *ngIf="drawerMappigVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '17px',
      'padding-right': '17px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsSkill"
    [nzVisible]="drawerMappigVisible" [nzTitle]="drawerMappingTitle" (nzOnClose)="draweMappingClose()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-skill-mapping [drawerClose]="closeCallbackMapping" [Type]="'Main'" [drawerVisible]="drawerMappigVisible"
        [data]="drawerData">
      </app-skill-mapping>
    </ng-container>
  </nz-drawer>
</div>

<div *ngIf="drawerVisibleDesigner">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '20px',
      'padding-right': '20px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widths11"
    [nzVisible]="drawerVisibleDesigner" [nzTitle]="drawerTitleDesigner" (nzOnClose)="drawerClosedesigner()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-add-details-drawer-main [closeCallbacksubDesigner]="closeCallbacksubDesigner"
        [drawerVisibleDesigner]="drawerVisibleDesigner" [dataDesigner]="dataDesigner">
      </app-add-details-drawer-main>
    </ng-container>
  </nz-drawer>
</div>

<!-- Mapping Help Document -->
<div *ngIf="drawerMappigVisibleHelp">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px',
      'padding-top': '10px',
      'padding-left': '17px',
      'padding-right': '17px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsDoc"
    [nzVisible]="drawerMappigVisibleHelp" [nzTitle]="drawerMappingTitleHelp" (nzOnClose)="draweMappingCloseHelp()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-map-help-documents [drawerClose]="HelpcloseCallbackMapping" [type]="'MAIN'"
        [drawerVisible]="drawerMappigVisibleHelp" [data]="drawerData">
      </app-map-help-documents>
    </ng-container>
  </nz-drawer>
</div>

<div *ngIf="drawerserviceVisibleMaped">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(105% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="widthsss"
    [nzVisible]="drawerserviceVisibleMaped" [nzTitle]="drawerTitleMaped" (nzOnClose)="drawerServiceMappingCloseMaped()"
    (nzKeyboard)="(true)">
    <ng-container *nzDrawerContent>
      <app-view-service-logs [drawerCloset]="closeServiceMappingCallbackMaped" [type]="'B2B'"
        [drawerVisiblet]="drawerserviceVisibleMaped" [serviceid]="serviceid"
        [data]="drawerDataMaped"></app-view-service-logs>
    </ng-container>
  </nz-drawer>
</div>

<div *ngIf="drawerFilterVisible">
  <nz-drawer [nzBodyStyle]="{
      height: 'calc(100% - 55px)',
      overflow: 'auto',
      'padding-bottom': '53px'
    }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="'70%'" [nzVisible]="drawerFilterVisible"
    [nzTitle]="drawerTitle" (nzOnClose)="drawerfilterClose()" (nzKeyboard)="(true)" [nzPlacement]="'right'">
    <ng-container *nzDrawerContent>
      <app-main-filter [drawerClose]="filtercloseCallback" [filterGroups]="[]" [TabId]="TabId" [fields]="filterFields"
        (filterApplied)="onFilterApplied($event)"></app-main-filter> </ng-container></nz-drawer>
</div>

<nz-modal [(nzVisible)]="isModalVisible" [nzTitle]="'Query Details'" [nzFooter]="null"
  (nzOnCancel)="handleCancel()"><ng-container *nzModalContent>
    <h6 style="text-align: center">{{ selectedQuery }}</h6>
  </ng-container>
</nz-modal>