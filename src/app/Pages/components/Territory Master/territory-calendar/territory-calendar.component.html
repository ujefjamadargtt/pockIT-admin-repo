<div class="container">
  <div *ngIf="loading" class="calendar-loading-overlay">
    <nz-spin [nzSpinning]="loading" nzSimple></nz-spin>
  </div>
  <nz-calendar [(ngModel)]="date" [(nzMode)]="mode" (nzPanelChange)="panelChange($event)"
    (nzSelectChange)="selectChange($event)">
    <ul *nzDateCell="let date" class="events" [class.disabled-date]="isPastOrToday(date)" [ngClass]="{
        'holiday-cell': isHoliday(date),
        'weekly-off-cell': isWeeklyOff(date)
      }" [ngStyle]="
        isHoliday(date)
          ? {
              position: 'relative',
              'background-color': '#ffebee',
              'border-radius': '6px',
              'min-height': '100%',
              padding: '4px',
              border: '2px solid #ffcdd2',
              width: '100%',
              height: '100%'
            }
          : isWeeklyOff(date)
          ? {
              position: 'relative',
              'background-color': '#ffeaea',
              'border-radius': '6px',
              'min-height': '100%',
              padding: '4px',
              border: '2px solid #ffb3b3',
              width: '100%',
              height: '100%',
              cursor: 'not-allowed',
              opacity: '0.6'
            }
          : { position: 'relative', 'min-height': '100%', padding: '4px' }
      " (click)="!isPastOrToday(date) && openModalIfNotWeeklyOff(date)">
      <div *ngIf="isHoliday(date)" class="isholidya"></div>
      <div *ngIf="isWeeklyOff(date)" class="weeklyoff">
        <p class="nonworking">
          Non-Working Days
        </p>
      </div>
      <ng-container *ngFor="let item of calenderdata">
        <ng-container *ngIf="isSameDate(date, item.DATE)">
          <li *ngIf="item.IS_HOLIDAY === 1 && item.STATUS === 1" [ngStyle]="{
              'list-style': 'none',
              padding: '4px 2px',
              'text-align': 'center',
              'margin-top': '6px'
            }">
            <span *ngIf="item.REASON && item.REASON.length > 16" class="holiday-reason" [ngClass]="{
                'holiday-reason-truncated':
                  item.REASON && item.REASON.length >= 16
              }" [nz-tooltip]="
                item.REASON && item.REASON.length > 16 ? item.REASON : null
              " [nzTooltipTitle]="item.REASON" nzTooltipPlacement="top" nzTooltipOverlayClassName="holiday-tooltip"
              [ngStyle]="{
                color: '#d32f2f',
                'font-weight': '600',
                'font-size': '10px',
                display: 'block',
                'line-height': '1.3',
                cursor:
                  item.REASON && item.REASON.length > 16 ? 'default' : 'default'
              }">
              {{
              item.REASON && item.REASON.length > 16
              ? item.REASON.slice(0, 16) + "..."
              : item.REASON
              }}
            </span>
            <span *ngIf="item.REASON && item.REASON.length <= 16" class="holiday-reason" [ngClass]="{
                'holiday-reason-truncated':
                  item.REASON && item.REASON.length >= 16
              }" [ngStyle]="{
                color: '#d32f2f',
                'font-weight': '600',
                'font-size': '10px',
                display: 'block',
                'line-height': '1.3',
                cursor:
                  item.REASON && item.REASON.length > 16 ? 'default' : 'default'
              }">
              {{ item.REASON }}
            </span>
          </li>
        </ng-container>
      </ng-container>
    </ul>
  </nz-calendar>
</div>
<nz-modal [(nzVisible)]="isVisible" (nzOnCancel)="closeModal()" (nzOnOk)="save()" [nzOkLoading]="loading"
  [nzMaskClosable]="false" [nzWidth]="400">
  <ng-container *nzModalContent>
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label nzRequired nzNoColon>
            {{ labelText }}
          </nz-form-label>
          <nz-form-control *ngIf="showReasonField" nzErrorTip="Please enter reason for holiday">
            <textarea rows="3" nz-input name="HOLIDAY_REASON" placeholder="Please enter reason"
              [(ngModel)]="saveData.HOLIDAY_REASON" maxlength="50" required></textarea>
            <h6 class="holiday">
              {{ saveData.HOLIDAY_REASON?.length || 0 }}/50
            </h6>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </ng-container>
</nz-modal>