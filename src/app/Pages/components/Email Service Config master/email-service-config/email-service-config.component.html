<div>
  <form nz-form #emailServiceConfigForm="ngForm">
    <nz-spin [nzSpinning]="isSpinning">
      <div nz-row nzGutter="16">
        <div nz-col nzSpan="14">
          <div class="my-box">
            <span><b>SMTP Server Configuration</b></span>
            <div nz-row>
              <div nz-col nzSpan="24">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Service Provider</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter Service Provider">
                    <input nz-input placeholder="Enter Service Provider" name="serviceProvider"
                      (keypress)="validateServiceProvider($event)" [(ngModel)]="data.SERVICE_PROVIDER"
                      autocomplete="off" maxlength="128" required (focus)="isFocused = 'SERVICE_PROVIDER'"
                      (blur)="isFocused = ''" />
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'SERVICE_PROVIDER' ||
                      (data.SERVICE_PROVIDER &&
                        isFocused === 'SERVICE_PROVIDER')
                    ">
                    {{ data.SERVICE_PROVIDER?.length || 0 }}/128
                  </h6>
                </nz-form-item>
              </div>
            </div>
            <div nz-row>
              <div nz-col nzSpan="15">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Encryption Type</nz-form-label>
                  <nz-form-control nzErrorTip="Please Select Encryption Type">
                    <nz-select nzPlaceHolder="Select encryption type" [(ngModel)]="data.ENCRYPTION_TYPE"
                      name="encryptionType" autocomplete="off" required nzShowSearch nzAllowClear>
                      <nz-option *ngFor="let data of EncryptionData" [nzValue]="data.Id" [nzLabel]="data.Name">
                      </nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="9">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Authentication Type</nz-form-label>
                  <nz-form-control nzErrorTip="Please Select Authentication Type">
                    <nz-select nzPlaceHolder="Select type" [(ngModel)]="data.AUTHENTICATION_TYPE"
                      name="authenticationType" autocomplete="off" required nzAllowClear>
                      <nz-option nzValue="Basic" nzLabel="Basic"></nz-option>
                      <nz-option nzValue="OAuth2" nzLabel="OAuth2"></nz-option>
                    </nz-select>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="15">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>SMTP Host</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter SMTP Host">
                    <input nz-input placeholder="Enter SMTP Host" name="smtpHost" [(ngModel)]="data.SMTP_HOST"
                      autocomplete="off" pattern="^([a-zA-Z0-9][-a-zA-Z0-9]*[a-zA-Z0-9]\.)+[a-zA-Z]{2,}$"
                      maxlength="128" required (focus)="isFocused = 'SMTP_HOST'" (blur)="isFocused = ''" />
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'SMTP_HOST' ||
                      (data.SMTP_HOST && isFocused === 'SMTP_HOST')
                    ">
                    {{ data.SMTP_HOST?.toString().length || 0 }}/128
                  </h6>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="9">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>SMTP Port</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter SMTP Port">
                    <input nz-input type="text" placeholder="Enter SMTP Port" name="smtpPort"
                      [(ngModel)]="data.SMTP_PORT" autocomplete="off" minlength="1" maxlength="128" required
                      (focus)="isFocused = 'SMTP_PORT'" (blur)="isFocused = ''" (keypress)="validateSMTPPort($event)" />
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'SMTP_PORT' ||
                      (data.SMTP_PORT && isFocused === 'SMTP_PORT')
                    ">
                    {{ data.SMTP_PORT?.toString().length || 0 }}/128
                  </h6>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="15">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>User Name</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter Valid User Name">
                    <input nz-input placeholder="Enter User Name" name="username" [(ngModel)]="data.USERNAME"
                      autocomplete="new-username" maxlength="128" required [pattern]="emailPattern"
                      (focus)="isFocused = 'username'" (blur)="isFocused = ''" />
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'username' ||
                      (data.USERNAME && isFocused === 'username')
                    ">
                    {{ data.USERNAME?.toString().length || 0 }}/128
                  </h6>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="9">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Password&nbsp;<span class="info-icon" nz-icon nzType="info-circle"
                      nzTheme="twotone" nz-tooltip
                      nzTooltipTitle="Password must be 8-20 characters long and include at least 1 uppercase letter, 1 special character, and 1 number."></span></nz-form-label>
                  <nz-form-control nzHasFeedback class="text-left" nzRequired>
                    <nz-input-group nzPrefixIcon="lock" [nzSuffix]="suffixTemplate">
                      <input nz-input [type]="passwordVisible ? 'text' : 'password'" name="passwordemail"
                        [(ngModel)]="data.PASSWORD" placeholder="Password" placeholder="Enter Password" required
                        minlength="8" maxlength="20" #password="ngModel" [pattern]="passwordPattern"
                        autocomplete="new-password" />
                    </nz-input-group>
                    <h6 class="password-hint" *ngIf="
                        data.PASSWORD != undefined &&
                        data.PASSWORD != null &&
                        data.PASSWORD != ''
                      ">
                    </h6>
                    <ng-template #suffixTemplate>
                      <i nz-icon [nzType]="passwordVisible ? 'eye' : 'eye-invisible'"
                        (click)="passwordVisible = !passwordVisible"></i>
                    </ng-template>
                  </nz-form-control>
                  <div class="password-error-message">
                    <span *ngIf="password.errors?.['required'] && password.touched">Password is required.</span>
                    <span *ngIf="password.errors?.['minlength'] && password.touched">Password must be at least 8
                      characters long.</span>
                    <span *ngIf="password.errors?.['maxlength'] && password.touched">Password cannot exceed 20
                      characters.</span>
                    <span
                      *ngIf="!password.errors?.['minlength'] && password.errors?.['pattern'] && password.touched">Password
                      must meet the specified pattern
                      requirements.</span>
                  </div>
                </nz-form-item>
              </div>
            </div>
          </div>
          <div class="my-box">
            <div nz-row>
              <div nz-col nzSpan="24">
                <nz-form-item>
                  <nz-form-label nzNoColon><b>Notes</b></nz-form-label>
                  <nz-form-control>
                    <textarea nz-input rows="2" placeholder="Enter Notes" name="notes" [(ngModel)]="data.NOTES"
                      autocomplete="off" maxlength="1024" (focus)="isFocused = 'NOTES'"
                      (blur)="isFocused = ''"></textarea>
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'NOTES' ||
                      (data.NOTES && isFocused === 'NOTES')
                    ">
                    {{ data.NOTES?.toString().length || 0 }}/1024
                  </h6>
                </nz-form-item>
              </div>
            </div>
          </div>
        </div>
        <div nz-col nzSpan="10">
          <div class="my-box">
            <span><b>Sender Information</b></span>
            <div nz-row>
              <div nz-col nzSpan="24">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Sender Name</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter Sender Name">
                    <input nz-input placeholder="Enter Sender Name" name="senderName" [(ngModel)]="data.SENDER_NAME"
                      (keypress)="commonFunction.alphaOnly($event)" autocomplete="off" maxlength="128" required
                      (focus)="isFocused = 'SENDER_NAME'" (blur)="isFocused = ''" />
                  </nz-form-control>
                  <h6 class="character-count-h6" *ngIf="
                      isFocused === 'SENDER_NAME' ||
                      (data.SENDER_NAME && isFocused === 'SENDER_NAME')
                    ">
                    {{ data.SENDER_NAME?.toString().length || 0 }}/128
                  </h6>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="24">
                <nz-form-item>
                  <nz-form-label nzRequired nzNoColon>Sender Email</nz-form-label>
                  <nz-form-control nzErrorTip="Please Enter a Valid Sender Email Address">
                    <input nz-input type="email" placeholder="Enter Sender Email" name="senderEmail"
                      [(ngModel)]="data.SENDER_EMAIL" [pattern]="emailPattern" autocomplete="off" maxlength="128"
                      required />
                    <h6 class="character-count-h6" *ngIf="
                        data.SENDER_EMAIL && data.SENDER_EMAIL.length > 128
                      ">
                      {{ data.SENDER_EMAIL.length }}/128
                    </h6>
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
          </div>
          <div class="my-box">
            <span class="section-title"><b>Other Information</b></span>
            <div nz-row>
              <div nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label nzNoColon>Retry Attempts</nz-form-label>
                  <nz-form-control>
                    <input nz-input type="text" placeholder="Enter Retry Attempts" name="retryAttempts"
                      [(ngModel)]="data.RETRY_ATTEMPTS" autocomplete="off" (keypress)="omit($event)" maxlength="11"
                      required />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="12">
                <nz-form-item>
                  <nz-form-label nzNoColon>Timeout (seconds)</nz-form-label>
                  <nz-time-picker name="TIMEOUT_SECONDS" [(ngModel)]="TIMEOUT_DATE" nzFormat="ss" nzPlaceHolder="Time"
                    (ngModelChange)="onTimeChange($event)">
                  </nz-time-picker>
                </nz-form-item>
              </div>
              <div nz-col nzSpan="8">
                <nz-form-item>
                  <nz-form-label nzNoColon>Status</nz-form-label>
                  <nz-form-control>
                    <nz-switch name="IS_ACTIVE" [(ngModel)]="data.IS_ACTIVE" nzCheckedChildren="Active"
                      nzUnCheckedChildren="Inactive" required></nz-switch>
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nz-spin>
  </form>
  <div class="footer">
    <button type="button" nz-button (click)="close()" class="ant-btn footer-btn-spacing">
      <span>Cancel</span>
    </button>
    <button type="button" class="ant-btn ant-btn-primary" *ngIf="!data.ID" nz-button nz-dropdown [nzDropdownMenu]="menu"
      [nzLoading]="isSpinning" (click)="save(false, emailServiceConfigForm)">
      <span>Save & Close</span>
    </button>
    <nz-dropdown-menu #menu="nzDropdownMenu">
      <ul nz-menu>
        <li nz-menu-item class="menuc footer-menu-item">
          <a class="footer-menu-link" (click)="save(true, emailServiceConfigForm)">
            Save & New
          </a>
        </li>
      </ul>
    </nz-dropdown-menu>
    <button type="button" class="ant-btn ant-btn-primary" nz-button [nzLoading]="isSpinning" *ngIf="data.ID"
      (click)="save(false, emailServiceConfigForm)">
      <span>Update & close</span>
    </button>
  </div>
</div>