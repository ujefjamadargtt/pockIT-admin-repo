<div class="filter-container">
    <div *ngFor="let group of filterGroups; let i = index">
        <div nz-row>
            <div nz-col nzSpan="8" class="group-title" Group {{ i + 1 }} <i *ngIf="filterGroups.length > 1" nz-tooltip
                nzTooltipTitle="Remove Condition" (click)="removeGroup(i)" class="icon-size-4 delete-icon" nz-icon
                nzType="delete">
                </i>
            </div>
            <div *ngIf="filterGroups.length > 1 && i != 0" nz-col nzSpan="8" class="text-center">
                <nz-select name="LogicalOperator{{ i }}" [(ngModel)]="group.operator"
                    class="logical-operator logical-operator-width">
                    <nz-option nzValue="AND" nzLabel="AND"></nz-option>
                    <nz-option nzValue="OR" nzLabel="OR"></nz-option>
                </nz-select>
            </div>
            <div nz-col nzSpan="24" class="group-conditions">
                <div class="condition-row" *ngFor="let conditionObj of group.conditions; let j = index">
                    <div nz-row [nzGutter]="16">
                        <div nz-col class="gutter-row" nzSpan="3">
                            <nz-select *ngIf="j > 0" name="operator{{ i }}{{ j }}" [(ngModel)]="conditionObj.operator"
                                class="full-width">
                                <nz-option nzValue="AND" nzLabel="AND"></nz-option>
                                <nz-option nzValue="OR" nzLabel="OR"></nz-option>
                            </nz-select>
                            <div *ngIf="j == 0" class="when-text">
                                When
                            </div>
                        </div>
                        <div nz-col class="gutter-row" nzSpan="6">
                            <nz-select name="Selector{{ i }}{{ j }}" [(ngModel)]="conditionObj.condition.field"
                                nzShowSearch (ngModelChange)="onFieldChange(conditionObj.condition)" class="full-width"
                                nzPlaceHolder="Select Column Name">
                                <nz-option *ngFor="let field of fields" [nzValue]="field.key" [nzLabel]="field.label">
                                </nz-option>
                            </nz-select>
                        </div>
                        <div nz-col class="gutter-row" nzSpan="6">
                            <nz-select name="Comparator{{ i }}{{ j }}" [(ngModel)]="conditionObj.condition.comparator"
                                class="full-width" nzPlaceHolder="Select Comparator">
                                <nz-option *ngFor="let comparator of getComparators(conditionObj.condition.field)"
                                    [nzValue]="comparator" [nzLabel]="comparator">
                                </nz-option>
                            </nz-select>
                        </div>
                        <div nz-col class="gutter-row" nzSpan="6">
                            <input name="value{{ i }}{{ j }}" *ngIf="isInputField(conditionObj.condition.field)"
                                nz-input [(ngModel)]="conditionObj.condition.value"
                                [placeholder]="getPlaceholder(conditionObj.condition.field)" class="full-width" />
                            <nz-date-picker name="value{{ i }}{{ j }}" *ngIf="isDateField(conditionObj.condition.field)"
                                [(ngModel)]="conditionObj.condition.value" class="full-width"
                                [nzPlaceHolder]="getPlaceholder(conditionObj.condition.field)">
                            </nz-date-picker>
                            <nz-select name="value{{ i }}{{ j }}" *ngIf="isSelectField(conditionObj.condition.field)"
                                [(ngModel)]="conditionObj.condition.value" class="full-width" nzShowSearch
                                [nzPlaceHolder]="getPlaceholder(conditionObj.condition.field)">
                                <nz-option *ngFor="let option of getOptions(conditionObj.condition.field)"
                                    [nzValue]="option.value" [nzLabel]="option.display">
                                </nz-option>
                            </nz-select>
                        </div>
                        <div nz-col class="gutter-row text-right" nzSpan="3">
                            <button *ngIf="group.conditions.length > 1" nzShape="circle" nz-button nzType="primary"
                                nzDanger (click)="removeCondition(i, j)">
                                <span nz-icon nzType="delete"></span>
                            </button>
                            <button nzShape="circle" class="add-condition-btn" nz-button nzType="primary"
                                (click)="addCondition(i, j)">
                                <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footer">
    <div class="filter-actions">
        <button nz-button nzType="primary" (click)="addGroup()">
            Add New Group
        </button>
        <button nz-button (click)="resetFilters()">Reset All</button>
        <button nz-button nzType="primary" (click)="openNameModal()">
            <span nz-icon nzType="filter"></span> Save Filter
        </button>
    </div>
</div>
<form (ngSubmit)="saveFilter('', false)">
    <nz-modal [(nzVisible)]="isVisible" [nzTitle]="'Enter Name For Filter'" (nzOnCancel)="handleCancel()"
        nzOkText="Save & Close" (nzOnOk)="handleOk()" [nzOkLoading]="loading">
        <ng-container *nzModalContent>
            <input nz-input [(ngModel)]="name" name="name" maxlength="128" placeholder="Enter Special Instruction"
                class="modal-input" autocomplete="off" />
            <span class="name-counter" *ngIf="name">{{ name.length }}/128</span>
        </ng-container>
    </nz-modal>
</form>