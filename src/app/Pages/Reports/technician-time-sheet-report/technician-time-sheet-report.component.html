<div nz-row nzType="flex">
    <div nz-col nzSpan="8">
        <div class="formname">
            <span (click)="back()" nz-icon nzType="arrow-left" nzTheme="outline" class="clickable-bold-icon"></span>
            &nbsp;&nbsp;{{ formTitle }}
        </div>
    </div>
    <div nz-col nzSpan="16" class="flex-end">
        <form nz-form nzLayout="inline">
            <nz-form-item>
                <button nz-button nzTooltipTitle="Excel" nzTooltipPlacement="top" nz-tooltip class="white-text-btn"
                    nzType="primary" (click)="importInExcel()" [nzLoading]="exportLoading">
                    <i nz-icon nzType="file-excel" nzTheme="outline"></i>
                </button>
            </nz-form-item>
            <nz-form-item>
                <button nz-button nzTooltipTitle="Filter" nzTooltipPlacement="top" nz-tooltip [nzType]="isFilterApplied"
                    (click)="showFilter()">
                    <i nz-icon nzType="filter"></i>
                </button>
            </nz-form-item>
            <nz-form-item>
                <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                    <input type="text" name="search" (keyup)="keyup($event)" (keydown.enter)="onEnterKey($event)"
                        nz-input placeholder="Min 3 chars required." [(ngModel)]="searchText" (onkeypress)="search()"
                        autocomplete="off" class="search-input" />
                </nz-input-group>
            </nz-form-item>
            <ng-template #suffixIconButton>
                <button nz-button nzType="primary" nzSearch class="search-button" (click)="search()">
                    <i nz-icon nzType="search"></i>
                </button>
            </ng-template>
        </form>
    </div>
</div>
<div nz-row>
    <div nz-col nzSpan="24">
        <div class="filter {{ filterClass }}">
            <div class="filter-box">
                <div nz-row nzGutter="10ox">
                    <div nz-col nzSpan="8">
                        <div nz-row>
                            <div nz-col nzSpan="24">
                                <nz-form-item>
                                    <nz-form-label nzNoColon>Scheduled Date</nz-form-label>
                                    <div nz-row>
                                        <div nz-col nzSpan="24" class="date-picker-container">
                                            <nz-date-picker class="date-picker start-date" [(ngModel)]="startdate"
                                                [nzFormat]="'dd/MM/yyyy'" nzAllowClear="false"></nz-date-picker>
                                            <nz-date-picker class="date-picker end-date" [(ngModel)]="enddate"
                                                [nzFormat]="'dd/MM/yyyy'" nzAllowClear="false"></nz-date-picker>
                                        </div>
                                    </div>
                                </nz-form-item>
                            </div>
                        </div>
                    </div>
                    <div nz-col nzSpan="16">
                        <nz-form-item>
                            <nz-form-label nzRequired nzNoColon>Technician Name</nz-form-label>
                            <nz-form-control nzErrorTip="Please Enter Technician Name">
                                <nz-select name="technName" class="full-width-select" nzShowSearch nzAllowClear
                                    nzPlaceHolder="Select Technician" nzMode="multiple"
                                    [nzCustomTemplate]="multipleTemplate" [(ngModel)]="selectedTechnician"
                                    [nzMaxTagCount]="3" (nzOnSearch)="searchTechnician($event)"
                                    (ngModelChange)="onTechnicianChange()">
                                    <nz-option *ngFor="let data of distinctData" [nzValue]="data.ID"
                                        [nzLabel]="data.NAME">
                                    </nz-option>
                                </nz-select>
                                <ng-template #multipleTemplate let-selected>
                                    <div class="ant-select-selection-item-content">
                                        <span nz-icon [nzType]="selected.nzValue"></span>
                                        {{ selected.nzLabel }}
                                    </div>
                                </ng-template>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
                <div nz-row nzGutter="10">
                    <div nz-col nzSpan="8">
                        <nz-form-item>
                            <nz-form-label nzRequired nzNoColon>Type</nz-form-label>
                            <nz-form-control nzErrorTip="Select Type">
                                <nz-radio-group [(ngModel)]="selectedType" (ngModelChange)="onTypeChange($event)">
                                    <label nz-radio nzValue="Job">Job</label>
                                    <label nz-radio nzValue="Order">Order</label>
                                </nz-radio-group>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col nzSpan="16" *ngIf="selectedType === 'Job'">
                        <nz-form-item>
                            <nz-form-label nzRequired nzNoColon>Job</nz-form-label>
                            <nz-form-control nzErrorTip="Please Select Job">
                                <nz-select name="jobName" class="full-width-select" nzShowSearch nzAllowClear
                                    nzServerSearch nzPlaceHolder="Select Job" nzMode="multiple" [nzMaxTagCount]="4"
                                    [(ngModel)]="selectedjob" [nzOptionOverflowSize]="7"
                                    (nzScrollToBottom)="loadMore1()" (nzOnSearch)="gejob($event)"
                                    (keyup)="keyup4($event)">
                                    <ng-template #renderTemplate>
                                        <nz-spin *ngIf="isLoading1"></nz-spin>
                                    </ng-template>
                                    <nz-option *ngFor="let data of jobcardData" [nzValue]="data.ID"
                                        [nzLabel]="data.JOB_CARD_NO"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col nzSpan="16" *ngIf="selectedType === 'Order'">
                        <nz-form-item>
                            <nz-form-label nzRequired nzNoColon>Order</nz-form-label>
                            <nz-form-control nzErrorTip="Please Select Order">
                                <nz-select name="orderName" class="full-width-select" nzShowSearch nzAllowClear
                                    nzServerSearch nzPlaceHolder="Select Order" nzMode="multiple" [nzMaxTagCount]="4"
                                    [(ngModel)]="selectedorder" [nzOptionOverflowSize]="7"
                                    (nzScrollToBottom)="loadMore()" (nzOnSearch)="getord($event)"
                                    (keyup)="keyup3($event)" [nzDropdownRender]="renderTemplate1">
                                    <ng-template #renderTemplate1>
                                        <nz-spin *ngIf="isLoading"></nz-spin>
                                    </ng-template>
                                    <nz-option *ngFor="let data of orderData" [nzValue]="data.ORDER_NUMBER"
                                        [nzLabel]="data.ORDER_NUMBER"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </div>
                <hr />
                <div nz-row>
                    <div nz-col nzSpan="8" class="action-buttons">
                        <button nz-button [nzLoading]="isSpinning" nzType="primary" class="flexicons"
                            (click)="applyFilter()">
                            <i nz-icon nzType="filter"></i>Apply Filter
                        </button>
                        <button nz-button nzType="default" class="flexicons" (click)="clearFilter()">
                            <i nz-icon nzType="delete"></i>Clear filter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div nz-row class="table-container">
    <div nz-col nzSpan="24">
        <nz-table class="my-scroll no-wrap1" #table [nzData]="dataList" [nzLoading]="loadingRecords"
            [nzTotal]="totalRecords" nzBordered [(nzPageIndex)]="pageIndex" [(nzPageSize)]="pageSize"
            (nzPageIndexChange)="search()" (nzPageSizeChange)="search(true)" (nzQueryParams)="sort($event)"
            [nzSize]="'small'" nzShowSizeChanger [nzFrontPagination]="false" [nzScroll]="{ y: '50vh', x: '100vw' }">
            <thead>
                <tr>
                    <th nzWidth="300px" nzLeft nzShowSort nzColumnKey="{{ 'TECHNICIAN_NAME' }}" [nzSortFn]="true"
                        [nzFilterFn]="true" nzCustomFilter class="text-center">
                        Technician Name
                        <nz-filter-trigger [(nzVisible)]="techniciannameVisible"
                            [nzDropdownMenu]="techniciannamedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': istechniciannameFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="200px" nzShowSort nzColumnKey="{{ 'EXPECTED_DATE_TIME' }}" [nzSortFn]="true"
                        nzCustomFilter class="text-center">
                        Expected Date Time
                        <nz-filter-trigger [(nzVisible)]="expectedDateVisible" [nzDropdownMenu]="expectedDatedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isexpectedDateFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="200px" nzShowSort nzColumnKey="{{ 'ORDER_NO' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        Order Number
                        <nz-filter-trigger [(nzVisible)]="ordernumberVisible" [nzDropdownMenu]="ordernumberdropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isordernumberFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="200px" nzShowSort nzColumnKey="{{ 'JOB_CARD_NO' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        Job Number
                        <nz-filter-trigger [(nzVisible)]="jobcardnumberVisible"
                            [nzDropdownMenu]="jobcardnumberdropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isjobcardnumberFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="300px" nzShowSort nzColumnKey="{{ 'SERVICE_NAME' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        Service Name
                        <nz-filter-trigger [(nzVisible)]="servicenameVisible" [nzDropdownMenu]="servicenamedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isservicenameFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="150px" nzShowSort nzColumnKey="{{ 'START_TIME' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        <nz-filter-trigger [(nzVisible)]="starttimeVisible" [nzDropdownMenu]="starttimedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isstarttimeFilterApplied}"></span>
                        </nz-filter-trigger>
                        Start Time
                    </th>
                    <th nzWidth="150px" nzShowSort nzColumnKey="{{ 'END_TIME' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        <nz-filter-trigger [(nzVisible)]="endtimeVisible" [nzDropdownMenu]="endtimedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isendtimeFilterApplied}"></span>
                        </nz-filter-trigger>
                        End Time
                    </th>
                    <th nzWidth="200px" nzShowSort nzColumnKey="{{ 'SCHEDULED_DATE_TIME' }}" [nzSortFn]="true"
                        nzCustomFilter class="text-center">
                        Scheduled Date Time
                        <nz-filter-trigger [(nzVisible)]="scheduledDateTimeVisible"
                            [nzDropdownMenu]="scheduledDateTimedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isscheduledDateTimeFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="200px" nzShowSort nzColumnKey="{{ 'END_DATE_TIME' }}" [nzSortFn]="true" nzCustomFilter
                        class="text-center">
                        End Date Time
                        <nz-filter-trigger [(nzVisible)]="enddDateTimeVisible" [nzDropdownMenu]="endDateTimedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isendDateTimeFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="240px" nzShowSort nzColumnKey="{{ 'JOB_COMPLETED_DATETIME' }}" [nzSortFn]="true"
                        nzCustomFilter class="text-center">
                        Job Completed Date Time
                        <nz-filter-trigger [(nzVisible)]="jobcompleteDateVisible"
                            [nzDropdownMenu]="jobcompleteDatedropdown">
                            <span nz-icon nzType="filter" nzTheme="fill"
                                [ngClass]="{'filter-applied': isjobcompleteDateFilterApplied}"></span>
                        </nz-filter-trigger>
                    </th>
                    <th nzWidth="120px" nzShowSort nzColumnKey="{{ 'TOTAL_TIME' }}" [nzSortFn]="true"
                        class="text-center">Total time</th>
                    <th nzWidth="150px" nzShowSort nzColumnKey="{{ 'IS_EARLY_OR_LATE' }}" [nzSortFn]="true"
                        class="text-center">Is Early Or Late</th>
                    <th nzWidth="150px" nzShowSort nzColumnKey="{{ 'WORK_DEVIATION' }}" [nzSortFn]="true"
                        class="text-center">Work Deviation</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of table.data">
                    <td nzLeft align="left" nz-tooltip
                        [nzTooltipTitle]="isTextOverflow ? data['TECHNICIAN_NAME'] : null">
                        <div class="truncate-text">{{ data["TECHNICIAN_NAME"] || "-" }}</div>
                    </td>
                    <td class="text-center">{{ data?.EXPECTED_DATE_TIME ? (data.EXPECTED_DATE_TIME | date : "dd/MM/yyyy
                        HH:mm a") : "-" }}</td>
                    <td align="left" nz-tooltip [nzTooltipTitle]="isTextOverflow ? data['ORDER_NO'] : null"
                        class="truncate-text">{{ data["ORDER_NO"] || "-" }}</td>
                    <td align="left" nz-tooltip [nzTooltipTitle]="isTextOverflow ? data['JOB_CARD_NO'] : null"
                        class="truncate-text">{{ data["JOB_CARD_NO"] || "-" }}</td>
                    <td align="left" nz-tooltip [nzTooltipTitle]="isTextOverflow ? data['SERVICE_NAME'] : null"
                        class="truncate-text">{{ data["SERVICE_NAME"] || "-" }}</td>
                    <td class="text-center">{{ formatTime(data.START_TIME) || "-" }}</td>
                    <td class="text-center">{{ formatTime(data.END_TIME) || "-" }}</td>
                    <td class="text-center">{{ data?.SCHEDULED_DATE_TIME ? (data.SCHEDULED_DATE_TIME | date :
                        "dd/MM/yyyy HH:mm a") : "-" }}</td>
                    <td class="text-center">{{ data?.END_DATE_TIME ? (data.END_DATE_TIME | date : "dd/MM/yyyy HH:mm a")
                        : "-" }}</td>
                    <td class="text-center">{{ data?.JOB_COMPLETED_DATETIME ? (data.JOB_COMPLETED_DATETIME | date :
                        "dd/MM/yyyy HH:mm a") : "-" }}</td>
                    <td align="left">{{ data.TOTAL_TIME || "-" }}</td>
                    <td align="left">{{ data.IS_EARLY_OR_LATE ? (data.IS_EARLY_OR_LATE === "E" ? "Early" : "Late") : "-"
                        }}</td>
                    <td class="text-center">{{ data.WORK_DEVIATION || "-" }}</td>
                </tr>
            </tbody>
        </nz-table>
        <nz-dropdown-menu #techniciannamedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="select">
                    <nz-select class="full-width-select" nzShowSearch nzAllowClear nzPlaceHolder="Select Technician"
                        nzMode="multiple" [nzCustomTemplate]="multipleTemplate" [(ngModel)]="selectedTechnician1"
                        (ngModelChange)="onTechnicianChange1()">
                        <nz-option *ngFor="let data of distinctData" [nzValue]="data.ID"
                            [nzLabel]="data.NAME"></nz-option>
                    </nz-select>
                    <ng-template #multipleTemplate let-selected>
                        <div class="ant-select-selection-item-content">
                            <span nz-icon [nzType]="selected.nzValue"></span>
                            {{ selected.nzLabel }}
                        </div>
                    </ng-template>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #expectedDatedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-range-picker [(ngModel)]="StartDate" name="StartDate" class="full-width-select"
                        [nzFormat]="commonFunction.dateFormatMMM" (ngModelChange)="onDateRangeChange()">
                    </nz-range-picker>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #ordernumberdropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-input-group [nzSuffix]="inputClearTpl">
                        <input type="text" nz-input [(ngModel)]="ordernumbertext" (keyup)="onKeyup($event)"
                            placeholder="Search Order Number" />
                    </nz-input-group>
                    <ng-template #inputClearTpl>
                        <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                            *ngIf="ordernumbertext" (click)="reset()"></span>
                        <span nz-icon nzType="search" nzTheme="outline" *ngIf="ordernumbertext == ''"></span>
                    </ng-template>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #jobcardnumberdropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-input-group [nzSuffix]="inputClearTpl">
                        <input type="text" nz-input [(ngModel)]="jobcardnumbertext" (keyup)="onKeyup($event)"
                            placeholder="Search Job Number" />
                    </nz-input-group>
                    <ng-template #inputClearTpl>
                        <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                            *ngIf="jobcardnumbertext" (click)="reset()"></span>
                        <span nz-icon nzType="search" nzTheme="outline" *ngIf="jobcardnumbertext == ''"></span>
                    </ng-template>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #servicenamedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-input-group [nzSuffix]="inputClearTpl">
                        <input type="text" nz-input [(ngModel)]="servicenametext" (keyup)="onKeyup($event)"
                            placeholder="Search Service Name" />
                    </nz-input-group>
                    <ng-template #inputClearTpl>
                        <span nz-icon class="ant-input-clear-icon" nzTheme="fill" nzType="close-circle"
                            *ngIf="servicenametext" (click)="reset()"></span>
                        <span nz-icon nzType="search" nzTheme="outline" *ngIf="servicenametext == ''"></span>
                    </ng-template>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #starttimedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="flex-align-center">
                    <nz-time-picker [(ngModel)]="fromTime" [nzFormat]="'HH:mm a'" [nzAllowEmpty]="true"
                        class="full-width-time-picker" (ngModelChange)="updateStartFromTime($event)"
                        nzPlaceHolder="From Time"></nz-time-picker>
                    To:
                    <nz-time-picker [(ngModel)]="toTime" [nzFormat]="'HH:mm a'" [nzAllowEmpty]="true"
                        (ngModelChange)="onTimeFilterChange()" class="full-width-time-picker"
                        nzPlaceHolder="To Time"></nz-time-picker>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #endtimedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="flex-align-center">
                    <nz-time-picker [(ngModel)]="endfromTime" [nzFormat]="'HH:mm a'" [nzAllowEmpty]="true"
                        class="full-width-time-picker" (ngModelChange)="updateStartFromTime($event)"
                        nzPlaceHolder="From Time"></nz-time-picker>
                    To:
                    <nz-time-picker [(ngModel)]="endtoTime" [nzFormat]="'HH:mm a'" [nzAllowEmpty]="true"
                        (ngModelChange)="onendTimeFilterChange()" class="full-width-time-picker"
                        nzPlaceHolder="To Time"></nz-time-picker>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #scheduledDateTimedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-range-picker [(ngModel)]="StartDate1" name="StartDate" class="full-width-select"
                        [nzFormat]="commonFunction.dateFormatMMM" (ngModelChange)="onDateRangeChange1()">
                    </nz-range-picker>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #endDateTimedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-range-picker [(ngModel)]="StartDate2" name="StartDate" class="full-width-select"
                        [nzFormat]="commonFunction.dateFormatMMM" (ngModelChange)="onDateRangeChange2()">
                    </nz-range-picker>
                </div>
            </div>
        </nz-dropdown-menu>
        <nz-dropdown-menu #jobcompleteDatedropdown="nzDropdownMenu">
            <div class="ant-table-filter-dropdown">
                <div class="search-box">
                    <nz-range-picker [(ngModel)]="StartDate3" name="StartDate2" class="full-width-select"
                        [nzFormat]="commonFunction.dateFormatMMM" (ngModelChange)="onDateRangeChange3()">
                    </nz-range-picker>
                </div>
            </div>
        </nz-dropdown-menu>
    </div>
</div>