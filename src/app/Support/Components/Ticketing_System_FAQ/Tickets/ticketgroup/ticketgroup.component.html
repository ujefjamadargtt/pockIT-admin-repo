<div>
    <div nz-row>
        <div nz-col nzSpan="12">
            <div class="formname">
                <span (click)="back()" nz-icon nzType="arrow-left" nzTheme="outline"
                    style="font-weight: bold; cursor: pointer"></span>&nbsp;&nbsp;{{ formTitle }}
            </div>
        </div>
        <div nz-col nzSpan="12" style="text-align: right">
            <button *ngIf="ticketId != null && ticketId != undefined && ticketId != 0" nz-button nzType="primary"
                (click)="Visible(1)">
                Update First Question
            </button>
        </div>
        <div nz-col nzSpan="24">
            <nz-empty *ngIf="ticketId == null || ticketId == undefined || ticketId == 0" [nzNotFoundImage]="
            'https://gw.alipayobjects.com/mdn/miniapp_social/afts/img/A*pevERLJC9v0AAAAAAAAAAABjAQAAAQ/original'
          " [nzNotFoundContent]="contentTpl" [nzNotFoundFooter]="footerTpl">
                <ng-template #contentTpl>
                    <span> No Question Found </span>
                </ng-template>
                <ng-template #footerTpl>
                    <button nz-button nzType="primary" (click)="Visible(1)">
                        Add First Question
                    </button>
                </ng-template>
            </nz-empty>
            <div *ngIf="ticketId != null && ticketId != undefined && ticketId != 0" style="margin-top: 5px">
                <div nz-row>
                    <!-- <div nz-col nzSpan="3"
                          style="padding:5px; text-align: center;border: 1px solid rgb(233, 233, 233);">
                          <b>Action</b>
                      </div> -->
                    <!-- <div nz-col nzSpan="21"
                          style="padding:5px;text-align: center;border: 1px solid rgb(233, 233, 233);">
                          <b>Ticket Groups</b>
                      </div> -->
                    <!-- <button #test ></button> -->
                    <div nz-col nzSpan="24">
                        <div class="sc">
                            <nz-tree [nzData]="nodes" #treeComponent [nzTreeTemplate]="nzTreeTemplate"
                                (nzExpandChange)="nzEvent($event)">
                            </nz-tree>
                            <ng-template #nzTreeTemplate let-node>
                                <span class="custom-node">
                                    <span *ngIf="node.title[0] == 'Q'">
                                        <!-- <i nz-icon nzType="file"></i> -->
                                        <span class="folder-name"
                                            style="color: #ff5d74; font-weight: bold; font-size: 15px"
                                            (click)="editOption(node.key)">{{ node.title }}</span>
                                        <span class="file-desc" *ngIf="node.origin['islast'] == 'No'"
                                            (click)="add2($event, 'O', node )">
                                            + Add Options</span>
                                        <span class="file-desc" *ngIf="node.origin['islast'] == 'Yes'"
                                            (click)="mapFaq2(node)">
                                            +Map FAQ</span>
                                    </span>
                                    <span *ngIf="node.title[0] == 'O'">
                                        <!-- <i nz-icon nzType="file"></i> -->
                                        <span class="file-name" style="
                          color: #0097d3;
                          font-weight: bold;
                          font-size: 12px;
                          cursor: pointer;
                        " (click)="editOption(node.key)">{{ node.title }}</span>
                                        <span class="file-desc" *ngIf="node.origin['islast'] == 'No'"
                                            (click)="add2($event, 'Q', node)">
                                            + Add Questions</span>
                                        <span class="file-desc" *ngIf="node.origin['islast'] == 'Yes'"
                                            (click)="mapFaq2(node)">
                                            + Map FAQ</span>
                                    </span>
                                </span>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <nz-drawer [nzBodyStyle]="{
          height: 'calc(100% - 55px)',
          overflow: 'auto',
          'padding-bottom': '53px'
        }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="900" [nzVisible]="addOptionVisible"
            [nzTitle]="formTitleHead" (nzOnClose)="drawerClose1()" (nzKeyboard)="(true)">
            <div>
                <div nz-row nzType="flex" *ngIf="type == 'O'">
                    <div nz-col nzXs="24" nzSm="24" nzMd="4" nzLg="6" nzXl="24"
                        style="display: flex; justify-content: flex-end">
                        <form nz-form [nzLayout]="'inline'">
                            <nz-form-item *ngIf="ticketQuestion.length == 0">
                                <button nz-button nzType="primary" (click)="add()" nzJustify="end">
                                    <i nz-icon nzType="plus"></i>Add New Question
                                </button>
                            </nz-form-item>
                        </form>
                    </div>
                </div>

                <div nz-row *ngIf="type == 'O'">
                    <div nz-col nzSpan="24">
                        <nz-table class="my-scroll no-wrap1" nzBordered #ticketTable [nzShowSizeChanger]="false"
                            [nzShowPagination]="false" [nzData]="ticketQuestion" [nzLoading]="loadingRecords"
                            [nzTotal]="totalRecords">
                            <thead>
                                <tr>
                                    <th>action</th>
                                    <th *ngFor="let column of columns">{{ column[1] }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let data2 of ticketTable.data">
                                    <td>
                                        <a (click)="edit(data2)">Edit</a>
                                    </td>
                                    <td *ngFor="let column of columns">{{ data2[column[0]] }}</td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </div>
                </div>

                <div nz-row nzType="flex" *ngIf="type == 'Q'">
                    <div nz-col nzXs="24" nzSm="24" nzMd="4" nzLg="6" nzXl="24"
                        style="display: flex; justify-content: flex-end">
                        <form nz-form [nzLayout]="'inline'">
                            <nz-form-item>
                                <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
                                    <input type="text" name="search" nz-input placeholder="Search Records"
                                        [(ngModel)]="searchText" />
                                </nz-input-group>
                                <ng-template #suffixIconButton>
                                    <button nz-button nzType="primary" (click)="loadTicketGroups2(filterQuery)"
                                        nzSearch>
                                        <i nz-icon nzType="search"></i>
                                    </button>
                                </ng-template>
                            </nz-form-item>
                            <nz-form-item>
                                <button nz-button nzType="primary" (click)="add()" *ngIf="visibleAdd" nzJustify="end">
                                    <i nz-icon nzType="plus"></i>Add New Options
                                </button>
                            </nz-form-item>
                        </form>
                    </div>
                </div>

                <div nz-row *ngIf="type == 'Q'">
                    <div nz-col nzSpan="24">
                        <nz-table class="my-scroll no-wrap1" nzBordered #ticketTable1 nzShowSizeChanger
                            [nzFrontPagination]="true" (nzQueryParams)="sort($event)" [nzData]="ticketGroups"
                            [nzLoading]="loadingRecords" [nzTotal]="totalRecords">
                            <thead>
                                <tr>
                                    <th>action</th>
                                    <th>Map FAQ</th>
                                    <th *ngFor="let column of columns" [nzSortFn]="true" nzColumnKey="{{ column[0] }}">
                                        {{ column[1] }}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let data of ticketTable1.data">
                                    <td>
                                        <a (click)="edit(data)">Edit</a>
                                    </td>
                                    <td>
                                        <a (click)="mapFaq(data)">Map</a>
                                    </td>
                                    <td *ngFor="let column of columns">{{ data[column[0]] }}</td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </div>
                </div>
            </div>
        </nz-drawer>
        <div *ngIf="addFirstQuestion">
            <nz-drawer [nzBodyStyle]="{
            height: 'calc(100% - 55px)',
            overflow: 'auto',
            'padding-bottom': '53px'
          }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="800"
                [nzVisible]="addFirstQuestion" [nzTitle]="Title" (nzOnClose)="drawerClose()" (nzKeyboard)="(true)">
                <!-- <div nz-col nzSpan="18" *ngIf="addFirstQuestion==true">
              <nz-card style="height: 650px;" [nzBordered]="true"> -->
                <div *nzDrawerContent>
                    <form nz-form #accountMasterPage="ngForm">
                        <nz-spin [nzSpinning]="isSpinning">
                            <div nz-row>
                                <div nz-col nzSpan="11">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Parent Name
                                        </nz-form-label>
                                        <nz-input-group>
                                            <nz-select name="parent_id23" [nzLoading]="parentLoading" nzShowSearch
                                                style="width: 100%" nzPlaceHolder="Select parent Name" disabled
                                                [(ngModel)]="ticketData.PARENT_ID">
                                                <nz-option *ngIf="ticketData.PARENT_ID == 0" [nzValue]="newId"
                                                    [nzLabel]="name1"></nz-option>
                                                <nz-option *ngFor="let val of parentTicketGroups" [nzValue]="val.ID"
                                                    [nzLabel]="val.VALUE">
                                                </nz-option>
                                            </nz-select>
                                        </nz-input-group>
                                    </nz-form-item>
                                </div>
                                <div nz-col nzSpan="2"></div>
                                <div nz-col nzSpan="11" *ngIf="ticketData.IS_LAST">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Department
                                        </nz-form-label>
                                        <nz-input-group>
                                            <nz-select name="department" [nzLoading]="departmentLoading" nzShowSearch
                                                style="width: 100%" nzPlaceHolder="Select Department Name"
                                                [(ngModel)]="ticketData.DEPARTMENT_ID">
                                                <nz-option *ngFor="let val of departments" [nzValue]="val.ID"
                                                    [nzLabel]="val.NAME">
                                                </nz-option>
                                            </nz-select>
                                        </nz-input-group>
                                    </nz-form-item>
                                </div>
                            </div>

                            <div nz-row>
                                <!-- <div nz-col nzSpan="5">
                                  <nz-form-item>
                                      <nz-form-label nzRequired nzNoColon>Type </nz-form-label>
                                      <nz-input-group>
                                          <nz-select name="type" nzShowSearch style="width: 100%"
                                              [(ngModel)]="ticketData.TYPE">
                                              <nz-option nzValue="Q" nzLabel="Question"></nz-option>
                                              <nz-option nzValue="O" nzLabel="Option"> </nz-option>
                                          </nz-select>
                                      </nz-input-group>
                                  </nz-form-item>
                              </div>
                              <div nz-col nzSpan="1"></div> -->
                                <div nz-col nzSpan="4" *ngIf="ticketData.TYPE == 'O'">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Sequence No.</nz-form-label>
                                        <nz-form-control nzErrorTip="Input is required">
                                            <input nz-input name="seq_no" type="number" [(ngModel)]="ticketData.SEQ_NO"
                                                required />
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col nzSpan="1" *ngIf="ticketData.TYPE == 'O'"></div>
                                <div nz-col nzSpan="3" *ngIf="ticketData.TYPE == 'O'">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Is Last?</nz-form-label>
                                        <nz-form-control>
                                            <nz-switch name="isLast" [(ngModel)]="ticketData.IS_LAST"
                                                nzCheckedChildren="Yes" nzUnCheckedChildren="No"></nz-switch>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>
                                <div nz-col nzSpan="1" *ngIf="ticketData.TYPE == 'O'"></div>
                                <div nz-col nzSpan="3">
                                    <nz-form-item>
                                        <nz-form-label nzNoColon>Status</nz-form-label>
                                        <nz-form-control>
                                            <nz-switch name="status" [(ngModel)]="ticketData.STATUS"
                                                nzCheckedChildren="Active" nzUnCheckedChildren="Inactive"></nz-switch>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>

                                <div nz-col nzSpan="1" *ngIf="ticketData.TYPE == 'O'"></div>
                                <div nz-col nzSpan="10" *ngIf="ticketData.TYPE == 'O'">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Ticket Type</nz-form-label>
                                        <nz-form-control>
                                            <nz-radio-group [(ngModel)]="ticketData.TICKET_TYPE" name="TicketType">
                                                <label nz-radio nzValue="C">Common</label>
                                                <label nz-radio nzValue="O">Order</label>
                                            </nz-radio-group>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div>




                                <div nz-col nzSpan="1" *ngIf="ticketData.IS_LAST"></div>
                                <div nz-col nzSpan="5" *ngIf="ticketData.TYPE == 'O' && ticketData.IS_LAST">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Priority
                                        </nz-form-label>
                                        <nz-input-group>
                                            <nz-select name="priorityfdf" style="width: 100%"
                                                [(ngModel)]="ticketData.PRIORITY">
                                                <nz-option nzValue="V" nzLabel="Very High"> </nz-option>
                                                <nz-option nzValue="H" nzLabel="High"> </nz-option>
                                                <nz-option nzValue="M" nzLabel="Medium"> </nz-option>
                                                <nz-option nzValue="L" nzLabel="Low"> </nz-option>
                                                <nz-option nzValue="O" nzLabel="Very Low"> </nz-option>
                                            </nz-select>
                                        </nz-input-group>
                                    </nz-form-item>
                                </div>
                            </div>

                            <div nz-row>
                                <div nz-col nzSpan="24">
                                    <nz-form-item>
                                        <nz-form-label nzRequired nzNoColon>Value</nz-form-label>
                                        <nz-form-control nzErrorTip="Please Enter Valid Value">
                                            <textarea nz-input rows="2" name="value" maxlength="128"
                                                [(ngModel)]="ticketData.VALUE" required (focus)="isFocused = 'VALUE'"
                                                (blur)="isFocused = ''"></textarea>
                                        </nz-form-control>
                                        <!-- <small *ngIf="ticketData.VALUE != undefined"
                        >{{ ticketData.VALUE.length }}/128</small
                      > -->
                                        <h6 style="color: red; font-size: 10px" *ngIf="
                          isFocused === 'VALUE' ||
                          (ticketData.VALUE && isFocused === 'VALUE')
                        ">
                                            {{ ticketData.VALUE.length }}/128
                                        </h6>
                                    </nz-form-item>
                                </div>
                            </div>

                            <!-- <div nz-row *ngIf="ticketData.TYPE == 'O' && ticketData.IS_LAST">
                                <div nz-col nzSpan="24">
                                    <nz-form-item>
                                        <nz-form-label nzNoColon>Alert Message</nz-form-label>
                                        <nz-form-control>
                                            <textarea nz-input rows="2" name="alertmsg"
                                                [(ngModel)]="ticketData.ALERT_MSG" maxlength="128"></textarea>
                                        </nz-form-control>
                                        <small *ngIf="ticketData.ALERT_MSG != undefined">{{ ticketData.ALERT_MSG.length
                                            }}/128</small>
                                    </nz-form-item>
                                </div>
                            </div> -->
                            <!-- 
                          <div nz-row>
                              <div nz-col nzSpan="24">
                                  <nz-form-item>
                                      <nz-form-label nzNoColon>Url </nz-form-label>
                                      <input type="file" accept="image/*" (change)="onFileSelectedURL($event)" />
                                  </nz-form-item>
                              </div>
                          </div>
                          <div nz-row *ngIf="ticketData.ID">
                              <div nz-col nzSpan="24">
                                  <nz-form-item>
                                      <img src="{{ticketData.URL}}" style="width:50px;height:50px;">
                                  </nz-form-item>
                              </div>
                          </div> -->
                        </nz-spin>
                    </form>
                    <div class="footer">
                        <button type="button" nz-button (click)="close(accountMasterPage)" class="ant-btn"
                            style="margin-right: 8px">
                            <span>Cancel</span>
                        </button>
                        <button type="button" class="ant-btn ant-btn-primary" *ngIf="!ticketData.ID" nz-button
                            (click)="save(false, accountMasterPage)">
                            <span>Save & Close</span>
                        </button>

                        <button type="button" class="ant-btn ant-btn-primary" nz-button [nzLoading]="isSpinning"
                            *ngIf="ticketData.ID" (click)="save(false, accountMasterPage)">
                            <span>Update & close</span>
                        </button>
                    </div>
                </div>
            </nz-drawer>
        </div>
        <nz-drawer [nzBodyStyle]="{
          height: 'calc(100% - 55px)',
          overflow: 'auto',
          'padding-bottom': '53px'
        }" [nzClosable]="true" [nzMask]="true" [nzMaskClosable]="false" [nzWidth]="900" [nzVisible]="mapFaqVisible"
            [nzTitle]="'Map FAQs'" (nzOnClose)="drawerClose2()" (nzKeyboard)="(true)">
            <div *nzDrawerContent>
                <div nz-row>
                    <div nz-col nzSpan="24">
                        <div style="font-weight: bold">{{ Question }}</div>
                        <div nz-row>
                            <div nz-col nzSpan="10"></div>
                            <div nz-col nzSpan="14">
                                <nz-form-item>
                                    <nz-form-label nzNoColon>FAQ Head </nz-form-label>
                                    <nz-input-group>
                                        <nz-select name="FAQHead" nzShowSearch style="width: 100%" [(ngModel)]="FAQHead"
                                            (ngModelChange)="setFilter($event)">
                                            <nz-option *ngFor="let data of faqdataList" [nzValue]="data.ID"
                                                [nzLabel]="data.NAME">
                                            </nz-option>
                                        </nz-select>
                                    </nz-input-group>
                                </nz-form-item>
                            </div>
                        </div>
                        <nz-table nzBordered #table2 [nzLoading]="loadingRecordsFaqs" [nzSize]="'small'" [nzData]="faqs"
                            nzShowPagination nzShowSizeChanger style="white-space: pre-line;">
                            <thead>
                                <tr>
                                    <th nzWidth="70px"> Status </th>
                                    <th nzWidth="300px"> FAQ</th>
                                    <th nzWidth="80px"> Seq. No.</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let data of table2.data; let i = index">
                                    <td align="center">
                                        <nz-switch name="status" [(ngModel)]="data.IS_SELECTED"></nz-switch>
                                    </td>
                                    <td>{{ data.QUESTION }}</td>
                                    <td>
                                        <nz-input-number name="saq_no{{ i }}" style="width: 100%;"
                                            [(ngModel)]="faqs[i]['SEQ_NO']" [nzMin]="0" [nzStep]="1"></nz-input-number>
                                    </td>
                                </tr>
                            </tbody>
                        </nz-table>
                    </div>
                </div>
                <div class="footer" *ngIf="mapFaqVisible">
                    <button type="button" nz-button (click)="closeFaqMap()" class="ant-btn" style="margin-right: 8px">
                        <span>Cancel</span>
                    </button>
                    <button type="button" class="ant-btn ant-btn-primary" nz-button [nzLoading]="isSpinning"
                        (click)="saveMappping()">
                        <span>Map FAQs</span>
                    </button>
                </div>
            </div>
        </nz-drawer>
    </div>
</div>